// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../symbols ../../core/Collection ../../core/has ../../core/Error ../../core/Evented ../../core/Handles ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/projectionEllipsoid ../../geometry/support/coordsUtils ../../layers/GraphicsLayer ../../views/DOMContainer ../../views/3d/interactive/editingTools/isSupportedGraphicUtils ../../views/3d/interactive/editingTools/moveGraphic/isSupportedGraphic ../../views/3d/interactive/editingTools/reshapeGraphic/isSupportedGraphic ../../views/3d/interactive/editingTools/transformGraphic/isSupportedGraphic ../../views/draw/support/layerUtils ../../views/input/InputManager ../../views/interactive/keybindings ../../views/interactive/snapping/SnappingManager ../../views/interactive/snapping/SnappingOptions ../../views/support/screenUtils ./support/OperationHandle ../../symbols/SimpleMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol".split(" "),
function(E,y,v,I,ba,t,ca,da,T,ea,q,P,fa,H,x,qa,ra,ha,ia,U,ja,ka,Q,la,K,ma,V,A,z,na,W,R,J,S,X,Y){function oa(B){return"polygon"===B||"rectangle"===B||"circle"===B?!0:!1}function L(B,F){Z("undo",B.history.undo,B.history.redo,F)}function M(B,F){Z("redo",B.history.redo,B.history.undo,F)}function Z(B,F,p,a){const c=F.pop().updates,d=[];a.forEach((b,f)=>{f=c[f];null!=f&&("geometry"in f&&q.isSome(f.geometry)&&(d.push({geometry:b.geometry}),b.geometry=f.geometry),"symbol"in f&&q.isSome(f.symbol)&&(d.push({symbol:b.symbol}),
b.symbol=f.symbol),"undo"in f&&(d.push(f),f[B](b)))});p.push({updates:d})}function G(B){return{updates:B.map(F=>({geometry:F.geometry}))}}function C(B){return"requireError"in B&&"aborted"===B.requireError}const N=B=>Object.freeze({__proto__:null,default:B}),pa=ea.getLogger("esri.widgets.Sketch.SketchViewModel"),aa={defaultZ:0},O={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,
preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,tool:"transform"};t=function(B){function F(a){a=B.call(this,a)||this;a._numUpdating=0;a._handles=new T;a._internalGraphicsLayer=new ja({listMode:"hide",internal:!0,title:"SVM Internal"});a._operationHandle=null;a._viewHandles=new T;a.activeFillSymbol=null;a.activeLineSymbol=null;a.activeVertexSymbol=null;a.allowDeleteKey=!0;a.layer=null;a.pointSymbol=new S({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}});a.polygonSymbol=
new X({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}});a.polylineSymbol=new Y({color:[130,130,130,1],width:2});a._snappingManager=null;a.updateGraphics=new ba;a.updateOnGraphicClick=!0;a.updatePointSymbol=new S({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}});a.updatePolygonSymbol=new X({color:[12,207,255,.2],outline:{join:"round",color:[12,207,255],width:2}});a.updatePolylineSymbol=new Y({color:[12,207,255],width:2});a.vertexSymbol=new S({style:"circle",size:6,color:[255,
255,255],outline:{color:[50,50,50],width:1}});a._moduleLoaderAbortController=null;a._viewReadyAbortController=null;a._originalAutoOpenEnabled=null;a.defaultCreateOptions=aa;a.defaultUpdateOptions=O;a.snappingOptions=new W;return a}y._inheritsLoose(F,B);var p=F.prototype;p.initialize=function(){this._handles.add([H.watch(this,"layer",()=>{this.cancel();this._internalGraphicsLayer.elevationInfo=q.isSome(this.layer)?this.layer.elevationInfo:null}),H.on(this,"view.map.layers","change",a=>{a.removed.includes(this.layer)&&
this.cancel()}),H.on(this,"layer.graphics","change",a=>{if(q.isSome(this._operationHandle))for(const c of a.removed)this.updateGraphics.includes(c)&&(1<this.updateGraphics.length?this._operationHandle.removeFromSelection(c):this._operationHandle.cancel())}),H.init(this,"layer.elevationInfo",()=>{this.cancel();this._internalGraphicsLayer.elevationInfo=q.isSome(this.layer)?this.layer.elevationInfo:null},!0),H.init(this,"view",a=>{q.destroyMaybe(this._snappingManager);a&&(this._snappingManager=new na.SnappingManager({view:a,
options:this.snappingOptions}),"2d"===a.type?new Promise((c,d)=>E(["../../views/2d/interactive/editingTools"],c,d)):"3d"===a.type&&(new Promise((c,d)=>E(["../../views/3d/interactive/editingTools"],c,d)),new Promise((c,d)=>E(["../../views/3d/layers/GraphicsLayerView3D"],b=>c(N(b)),d))))},!0)])};p.destroy=function(){this.cancel();this._handles=q.destroyMaybe(this._handles);this._viewHandles=q.destroyMaybe(this._viewHandles);this._removeDefaultLayer();this._snappingManager=q.destroyMaybe(this._snappingManager);
this._set("view",null);this.emit("destroy")};p.cancel=function(){this._moduleLoaderAbortController=q.abortMaybe(this._moduleLoaderAbortController);this._viewReadyAbortController=q.abortMaybe(this._viewReadyAbortController);this._operationHandle&&this._operationHandle.cancel()};p.complete=function(){this._operationHandle&&this._operationHandle.complete()};p.delete=function(){const {state:a,updateGraphics:c}=this;if("active"===a&&c.length){const {activeTool:d,layer:b}=this,f=c.toArray();b.removeMany(f);
this.cancel();this._emitDeleteEvent({graphics:f,tool:d})}};p.create=function(){var a=y._asyncToGenerator(function*(c,d){this.cancel();yield this._waitViewReady();if("disabled"===this.state)throw this.layer||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),this.view||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),P.createAbortError();q.isSome(this.view.activeTool)&&(this.view.activeTool=null);if(c){V.addUniqueLayer(this.view,
this._internalGraphicsLayer);var b=yield this._setupCreateOperation(c,d);q.isNone(b)||this.destroyed?this.view.map.remove(this._internalGraphicsLayer):(b.on("complete",()=>{if(b===this._operationHandle){const f=this.createGraphic,e=this._operationHandle.cancelled;this._operationHandle.destroy();this._operationHandle=null;this._set("createGraphic",null);this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer);b.cancelled||null==f||this.layer.add(f);this.emit("create",{graphic:f,
state:e?"cancel":"complete",tool:c,toolEventInfo:null,type:"create"})}}),this._operationHandle=b,this.view.ready&&ka.isDOMContainer(this.view)&&this.view.focus())}else this._logError("sketch:missing-parameter","Missing parameter 'tool'.")});return function(c,d){return a.apply(this,arguments)}}();p.update=function(){var a=y._asyncToGenerator(function*(c,d){this.cancel();yield this._waitViewReady();const {layer:b,view:f,state:e}=this;if("disabled"===e)throw f||this._logError("sketch:missing-property",
"Property 'view' is missing on SketchViewModel."),b||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),P.createAbortError();q.isSome(this.view.activeTool)&&(this.view.activeTool=null);const h=Array.isArray(c)?c:[c];null!=c&&h&&h.length?h.some(g=>g.layer!==b?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):q.isNone(g.geometry)?(this._logError("sketch:invalid-parameter",
"Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):"2d"!==f.type||f.spatialReference.equals(g.geometry.spatialReference)?!1:(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with a spatial reference different from the supplied MapView."),!0))||(c=yield this._setupUpdateOperation(h,d),this.destroyed||q.isNone(c)||C(c)||(V.addUniqueLayer(this.view,this._internalGraphicsLayer),this._setUpdateOperationHandle(c,d),this.emit("update",
{graphics:h,state:"start",aborted:!1,tool:c.tool,toolEventInfo:null,type:"update"}))):this._logError("sketch:missing-parameter","Missing parameter 'graphics'.")});return function(c,d){return a.apply(this,arguments)}}();p.undo=function(){this.canUndo()&&this._operationHandle.undo()};p.redo=function(){this.canRedo()&&this._operationHandle.redo()};p.canUndo=function(){return!(!this._operationHandle||!this._operationHandle.canUndo())};p.canRedo=function(){return!(!this._operationHandle||!this._operationHandle.canRedo())};
p.toggleUpdateTool=function(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()};p._getFirstHit=function(){var a=y._asyncToGenerator(function*(c){const d=[];switch(this.view.type){case "2d":{const f=[];this.view.map.allLayers.forEach(e=>{"vector-tile"!==e.type&&"imagery"!==e.type||f.push(e)});var b=yield this.view.hitTest(c,{exclude:f});0<b.results.length&&(b=b.results[0],b.graphic&&d.push(b))}break;case "3d":{const f=[this.view.map.ground];this.view.map.allLayers.forEach(e=>
{"integrated-mesh"===e.type&&f.push(e)});b=yield this.view.hitTest(c,{exclude:f});if(0<b.results.length){const e=b.results[0];(!b.ground.mapPoint||1>this.view.map.ground.opacity||b.ground.distance-q.unwrapOr(e.distance,0)>-Math.min(3*b.ground.distance,"global"===this.view.viewingMode?ia.getReferenceEllipsoid(this.view.renderCoordsHelper.spatialReference).radius/this.view.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY))&&d.push(e)}}}return{screenPoint:c,results:d}});return function(c){return a.apply(this,
arguments)}}();p._generateViewHandles=function(a){var c=this;return[a.on("immediate-click",function(){var d=y._asyncToGenerator(function*(b){var f="active"===c.state&&"create"===c._operationHandle.type;if("disabled"!==c.state&&!f&&c.updateOnGraphicClick){c._beginAsyncOperation();var e=(yield b.async(()=>c._getFirstHit(R.createScreenPointFromEvent(b)))).results;f=null;if(e.length)for(const h of e){if(h.graphic){e=h.graphic;if(c.updateGraphics.includes(e)||e.layer===c.layer){b.stopPropagation();f=e;
break}"2d"!==a.type||c._isComponentGraphic(e)||"active"!==c.state||c.cancel()}}else"active"===c.state&&c.cancel();q.isSome(f)&&!c.updateGraphics.includes(f)&&(yield c.update([f],{...c.defaultUpdateOptions,reshapeOptions:{...c.defaultUpdateOptions.reshapeOptions}}));c._endAsyncOperation()}});return function(b){return d.apply(this,arguments)}}(),A.ViewEventPriorities.WIDGET)]};p._setupCreateOperation=function(){var a=y._asyncToGenerator(function*(c,d){c=yield this._setupDrawGraphicTool(c,this.view,
{hasZ:"3d"===this.view.type,...this.defaultCreateOptions,...d});if(q.isNone(c))return null;this.view.tools.add(c);this.view.activeTool=c;return this._setupCreateOperationHandle(c)});return function(c,d){return a.apply(this,arguments)}}();p._setupDrawGraphicTool=function(){var a=y._asyncToGenerator(function*(c,d,b){if("multipoint"===c&&"3d"===d.type)return this._logError("sketch:create","Multipoint geometries are not supported in SceneView"),null;const f="rectangle"!==c,e="rectangle"!==c;this.snappingOptions.enabledToggled=
!1;c={view:d,mode:"rectangle"===c||"circle"===c?"hybrid":"click",...b,snapToScene:!1,geometryType:c,graphicSymbol:this._getGraphicSymbolFromTool(c),snappingManager:this._snappingManager,forceUniformSize:e,centered:f};return"2d"===this.view.type?this._makeDrawGraphicTool2D(c):this._makeDrawGraphicTool3D(c)});return function(c,d,b){return a.apply(this,arguments)}}();p._makeDrawGraphicTool2D=function(){var a=y._asyncToGenerator(function*(c){const d=yield this._requireModule(new Promise((b,f)=>E(["../../views/2d/interactive/editingTools"],
b,f)));return C(d)||this.destroyed?null:new d.module.DrawGraphicTool2D({...c,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:oa(c.geometryType)?this.activeFillSymbol:null})});return function(c){return a.apply(this,arguments)}}();p._makeDrawGraphicTool3D=function(){var a=y._asyncToGenerator(function*(c){const d=yield this._requireModule(new Promise((b,f)=>E(["../../views/3d/interactive/editingTools"],b,f)));
return C(d)||this.destroyed?null:new d.module.DrawGraphicTool3D({...c,elevationInfo:this.layer.elevationInfo,snapToScene:q.isSome(this.layer.elevationInfo)?"absolute-height"===this.layer.elevationInfo.mode:!0})});return function(c){return a.apply(this,arguments)}}();p._setupCreateOperationHandle=function(a){let c=null;const d=a.forceUniformSize,b=a.centered,f=[this.view.on("key-down",h=>{if(h.key===z.SKETCH_KEYS.pan)h.stopPropagation(),h.repeat||(a.enabled=!1);else if(h.key===z.SKETCH_KEYS.complete)h.stopPropagation(),
a.completeCreateOperation();else if(h.key!==z.SKETCH_KEYS.vertexAdd||h.repeat)h.key===z.SKETCH_KEYS.undo?(h.stopPropagation(),e.undo()):h.key===z.SKETCH_KEYS.redo?(h.stopPropagation(),e.redo()):h.key!==z.SKETCH_KEYS.snappingToggle||"rectangle"===a.geometryType||"circle"===a.geometryType||h.repeat?h.key!==z.SKETCH_KEYS.constraint||"rectangle"!==a.geometryType&&"circle"!==a.geometryType||h.repeat?h.key!==z.SKETCH_KEYS.center||h.repeat||(a.centered=!b,h.stopPropagation()):(a.forceUniformSize=!d,h.stopPropagation()):
(this.snappingOptions.enabledToggled=!0,h.stopPropagation());else{const g=a.drawOperation.geometryType;if("polyline"===g||"polygon"===g||"multipoint"===g)h.stopPropagation(),a.drawOperation.commitStagedVertex()}},A.ViewEventPriorities.WIDGET),this.view.on("key-up",h=>{h.key===z.SKETCH_KEYS.pan?a.enabled=!0:h.key===z.SKETCH_KEYS.snappingToggle&&"rectangle"!==a.geometryType&&"circle"!==a.geometryType?(this.snappingOptions.enabledToggled=!1,h.stopPropagation()):h.key!==z.SKETCH_KEYS.constraint||"rectangle"!==
a.geometryType&&"circle"!==a.geometryType?h.key===z.SKETCH_KEYS.center&&(a.centered=b,h.stopPropagation()):(a.forceUniformSize=d,h.stopPropagation())},A.ViewEventPriorities.WIDGET),a.on("vertex-add",h=>{c=q.isNone(c)?"start":"active";switch(h.operation){case "apply":this.emit("create",{graphic:q.unwrap(a.graphic),state:c,tool:this.activeTool,toolEventInfo:h,type:"create"});break;case "undo":this._emitUndoEvent({graphics:[q.unwrap(a.graphic)],tool:a.geometryType});break;case "redo":this._emitRedoEvent({graphics:[q.unwrap(a.graphic)],
tool:a.geometryType})}}),a.on("cursor-update",h=>{0<a.drawOperation.numCommittedVertices&&this.emit("create",{graphic:q.unwrap(a.graphic),state:"active",tool:this.activeTool,toolEventInfo:{coordinates:h.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),a.on("vertex-remove",h=>{switch(h.operation){case "apply":this.emit("create",{graphic:q.unwrap(a.graphic),state:"active",tool:this.activeTool,toolEventInfo:h,type:"create"});break;case "undo":this._emitUndoEvent({graphics:[q.unwrap(a.graphic)],
tool:a.geometryType});break;case "redo":this._emitRedoEvent({graphics:[q.unwrap(a.graphic)],tool:a.geometryType})}}),a.on("complete",h=>{this._set("createGraphic",q.unwrap(h.graphic));c="complete";h.aborted?e&&e.cancel():e&&e.complete()}),fa.react(()=>this._getGraphicSymbolFromTool(a.geometryType),h=>{a.graphicSymbol=h})],e=new J.OperationHandle({activeComponent:a,tool:a.geometryType,type:"create",onEnd:()=>{var h;f.forEach(g=>g.remove());f.length=0;null==(h=this.view.tools)?void 0:h.remove(a);a.destroy()},
undo:()=>{a.canUndo&&a.undo()},redo:()=>{a.canRedo&&a.redo()},canUndo:()=>a.canUndo,canRedo:()=>a.canRedo});return e};p._getGraphicSymbolFromTool=function(a){switch(a){case "point":case "multipoint":return this.pointSymbol;case "polyline":return this.polylineSymbol;case "circle":case "rectangle":case "polygon":return this.polygonSymbol;default:return null}};p._setupUpdateOperation=function(){var a=y._asyncToGenerator(function*(c,d){const {layer:b,view:f}=this;d={tool:this._defaultUpdateTool,...this.defaultUpdateOptions,
...d,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...null==d?void 0:d.reshapeOptions}};var e=d.tool;for(var h of c)b.remove(h),b.add(h);if("3d"===f.type){if(0===c.length)return null;switch(e){case "move":return this._setupMove3DOperation(c,d,f,e);case "reshape":if(1<c.length)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;e=K.isSupportedGraphic(c[0]);if(0===e)return this._setupReshape3DOperation(c[0],d,f);this._logError("sketch:reshape",
`Reshape operation not supported for provided graphic(s) (${Q.isSupportedGraphicResultMessage(e)}).`);return null;case "transform":return this._setupGraphicTransform3DOperation(c,d,f)}}switch(e){case "move":return this._setupMoveOperation(c,d,f);case "reshape":if(1<c.length)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;h=K.isSupportedGraphic(c[0]);if(0===h)return this._setupTransformOrReshapeOperation(c,e,d,f);this._logError("sketch:reshape",
`Reshape operation not supported for provided graphic(s) (${Q.isSupportedGraphicResultMessage(h)}).`);return null;case "transform":return 1===c.length&&(h=q.get(c[0].geometry,"type"),"point"===h||"multipoint"===h)&&(e="reshape"),this._setupTransformOrReshapeOperation(c,e,d,f)}});return function(c,d){return a.apply(this,arguments)}}();p._setupMove3DOperation=function(){var a=y._asyncToGenerator(function*(c,d,b,f,e=!1){var h=this;for(var g of c){const k=la.isSupportedGraphic(g);if(0!==k)return this._logError("sketch:move",
`Move operation not supported for provided graphic(s) (${Q.isSupportedGraphicResultMessage(k)}).`),null}g=yield this._requireModule(new Promise((k,m)=>E(["../../views/3d/interactive/editingTools"],k,m)));if(C(g))return g;const r=new g.module.GraphicMoveTool({view:b,enableZ:d.enableZ,snappingManager:this._snappingManager});this.view.tools.add(r);r.graphics.addMany(c);e||this.updateGraphics.addMany(c);const n=[],l=new J.UpdateOperationHandle({activeComponent:r,tool:f,type:"update",onEnd:()=>{var k;
n.forEach(m=>m.remove());n.length=0;null==(k=this.view.tools)?void 0:k.remove(r);r.destroyed||r.destroy()},undo:()=>{L(l,this.updateGraphics.toArray());this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:f})},redo:()=>{M(l,this.updateGraphics.toArray());this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:f})},addToSelection:k=>{this.updateGraphics.push(k);r.graphics.push(k);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,
toolEventInfo:{added:[k],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:k=>{const m=this.updateGraphics.indexOf(k);l.history.undo.forEach(w=>w.updates.splice(m,1));l.history.redo.forEach(w=>w.updates.splice(m,1));this.updateGraphics.remove(k);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[k],type:"selection-change"},type:"update"});0===this.updateGraphics.length?l.complete():r.graphics.remove(k)},
toggleTool:function(){var k=y._asyncToGenerator(function*(){if(1===h.updateGraphics.length&&!1!==d.toggleToolOnClick&&"transform"===f){var m=h.updateGraphics.getItemAt(0);0===K.isSupportedGraphic(m)&&(m=yield h._setupReshape3DOperation(m,d,b,!0),C(m)||(l.onEnd(),l.destroy(),h._setUpdateOperationHandle(m,d)))}});return function(){return k.apply(this,arguments)}}()});n.push(...this._getHandlesForComponent(l,d),this.view.on("immediate-click",k=>this._getCommonUpdateOperationClickHandlers(l,k,d),A.ViewEventPriorities.WIDGET),
b.on("key-down",k=>{this._getCommonUpdateOperationKeyDownHandlers(l,k);k.key===z.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!0,k.stopPropagation())},A.ViewEventPriorities.WIDGET),b.on("key-up",k=>{k.key===z.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!1,k.stopPropagation())},A.ViewEventPriorities.WIDGET));return l});return function(c,d,b,f){return a.apply(this,arguments)}}();p._setupGraphicTransform3DOperation=function(a,c,d,b=!1){if(1===a.length&&0===ma.isSupportedGraphic(a[0])){const f=
a[0],e=f.geometry;if(q.isSome(e)&&("point"===e.type||"mesh"===e.type))return this._setupPointTransform3DOperation(f,c,d);if(q.isSome(e)&&("polygon"===e.type||"polyline"===e.type))return this._setupPolyTransform3DOperation(f,c,d,b)}return this._setupMove3DOperation(a,c,d,"transform",b)};p._setupPointTransform3DOperation=function(){var a=y._asyncToGenerator(function*(c,d,b){var f=this;const {enableRotation:e,enableScaling:h,enableZ:g}=d,r=yield this._requireModule(new Promise((m,w)=>E(["../../views/3d/interactive/editingTools"],
m,w)));if(C(r))return r;const n=new r.module.GraphicTransformTool({graphic:c,view:b,enableRotation:e,enableScaling:h,enableZ:g,snappingManager:this._snappingManager});this.view.tools.add(n);this.updateGraphics.add(c);const l=[],k=new J.UpdateOperationHandle({activeComponent:n,tool:"transform",type:"update",onEnd:()=>{var m;l.forEach(w=>w.remove());l.length=0;null==(m=this.view.tools)?void 0:m.remove(n);n.destroyed||n.destroy()},undo:()=>{L(k,this.updateGraphics.toArray());this._emitUndoEvent({graphics:this.updateGraphics.toArray(),
tool:"transform"})},redo:()=>{M(k,this.updateGraphics.toArray());this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:"transform"})},addToSelection:function(){var m=y._asyncToGenerator(function*(w){f.updateGraphics.add(w);f.emit("update",{graphics:f.updateGraphics.toArray(),state:"active",aborted:!1,tool:f.activeTool,toolEventInfo:{added:[w],removed:[],type:"selection-change"},type:"update"});w=yield f._setupMove3DOperation(f.updateGraphics.toArray(),d,b,"transform",!0);C(w)||(k.onEnd(),
k.destroy(),f._setUpdateOperationHandle(w,d))});return function(w){return m.apply(this,arguments)}}(),removeFromSelection:m=>{this.updateGraphics.remove(m);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[m],type:"selection-change"},type:"update"});k.complete()},toggleTool:()=>{}});l.push(...this._getHandlesForComponent(k,d),this.view.on("immediate-click",m=>this._getCommonUpdateOperationClickHandlers(k,m,d),
A.ViewEventPriorities.WIDGET),b.on("key-down",m=>{this._getCommonUpdateOperationKeyDownHandlers(k,m);m.key===z.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!0,m.stopPropagation())},A.ViewEventPriorities.WIDGET),b.on("key-up",m=>{m.key===z.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!1,m.stopPropagation())},A.ViewEventPriorities.WIDGET));return k});return function(c,d,b){return a.apply(this,arguments)}}();p._setupPolyTransform3DOperation=function(){var a=y._asyncToGenerator(function*(c,
d,b,f=!1){var e=this;const {enableRotation:h,enableScaling:g,enableZ:r,preserveAspectRatio:n}=d,l=yield this._requireModule(new Promise((u,D)=>E(["../../views/3d/interactive/editingTools"],u,D)));if(C(l))return l;const k=new l.module.ExtentTransformTool({graphic:c,view:b,enableRotation:h,enableScaling:g,enableZ:r,preserveAspectRatio:n});this.view.tools.add(k);f||this.updateGraphics.add(c);const m=[],w=new J.UpdateOperationHandle({activeComponent:k,tool:"transform",type:"update",onEnd:()=>{var u;m.forEach(D=>
D.remove());m.length=0;null==(u=this.view.tools)?void 0:u.remove(k);k.destroyed||k.destroy()},canUndo:()=>k.canUndo,undo:()=>{k.undo();this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:"transform"})},canRedo:()=>k.canRedo,redo:()=>{k.redo();this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:"transform"})},addToSelection:function(){var u=y._asyncToGenerator(function*(D){e.updateGraphics.add(D);e.emit("update",{graphics:e.updateGraphics.toArray(),state:"active",aborted:!1,
tool:e.activeTool,toolEventInfo:{added:[D],removed:[],type:"selection-change"},type:"update"});D=yield e._setupMove3DOperation(e.updateGraphics.toArray(),d,b,"transform",!0);C(D)||(w.onEnd(),w.destroy(),e._setUpdateOperationHandle(D,d))});return function(D){return u.apply(this,arguments)}}(),removeFromSelection:u=>{this.updateGraphics.remove(u);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[u],type:"selection-change"},
type:"update"});w.complete()},toggleTool:function(){var u=y._asyncToGenerator(function*(){if(1===e.updateGraphics.length&&!1!==d.toggleToolOnClick){var D=e.updateGraphics.getItemAt(0);0===K.isSupportedGraphic(D)&&(D=yield e._setupReshape3DOperation(D,d,b,!0),C(D)||(w.onEnd(),w.destroy(),e._setUpdateOperationHandle(D,d)))}});return function(){return u.apply(this,arguments)}}()});m.push(...this._getHandlesForComponent(w,d),this.view.on("immediate-click",u=>this._getCommonUpdateOperationClickHandlers(w,
u,d),A.ViewEventPriorities.WIDGET),this.view.on("key-down",u=>this._getCommonUpdateOperationKeyDownHandlers(w,u),A.ViewEventPriorities.WIDGET),this.view.on("key-down",u=>{u.key!==z.SKETCH_KEYS.constraint||u.repeat||(k.preserveAspectRatio=!k.preserveAspectRatio,u.stopPropagation())},A.ViewEventPriorities.WIDGET),this.view.on("key-up",u=>{u.key===z.SKETCH_KEYS.constraint&&(k.preserveAspectRatio=!k.preserveAspectRatio,u.stopPropagation())},A.ViewEventPriorities.WIDGET));return w});return function(c,
d,b){return a.apply(this,arguments)}}();p._setupMoveOperation=function(){var a=y._asyncToGenerator(function*(c,d,b){this.updateGraphics.addMany(c);const f=yield this._getGraphicMover(c,d,b);if(C(f))return f;const e=new J.UpdateOperationHandle({activeComponent:f,tool:"move",type:"update",onEnd:()=>{var n;this._displayDefaultCursor();r.forEach(l=>l.remove());g.forEach(l=>l.remove());r=[];g=[];f.destroy();null==(n=this._internalGraphicsLayer)?void 0:n.removeMany([...this.updateGraphics.toArray()])},
undo:()=>{const n=this.updateGraphics.toArray();L(e,n);e.refreshComponent();this._emitUndoEvent({graphics:n,tool:"move"})},redo:()=>{const n=this.updateGraphics.toArray();M(e,n);e.refreshComponent();this._emitRedoEvent({graphics:n,tool:"move"})},addToSelection:n=>{this.updateGraphics.push(n);f.graphics=this.updateGraphics.toArray();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[n],removed:[],type:"selection-change"},
type:"update"})},removeFromSelection:n=>{const l=this.updateGraphics.indexOf(n);e.history.undo.forEach(m=>m.updates.splice(l,1));e.history.redo.forEach(m=>m.updates.splice(l,1));this.updateGraphics.remove(n);const k=this.updateGraphics.toArray();this.emit("update",{graphics:k,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[n],type:"selection-change"},type:"update"});0===this.updateGraphics.length?e.complete():f.graphics=k}});let h=!1,g=[b.on("immediate-click",n=>this._getCommonUpdateOperationClickHandlers(e,
n,d),A.ViewEventPriorities.WIDGET),b.on("key-down",n=>{this._getCommonUpdateOperationKeyDownHandlers(e,n);n.key!==z.SKETCH_KEYS.constraint||n.repeat||(h=!0,f.enableMoveAllGraphics=!f.enableMoveAllGraphics)},A.ViewEventPriorities.WIDGET),b.on("key-up",n=>{n.key===z.SKETCH_KEYS.constraint&&h&&(h=!1,f.enableMoveAllGraphics=!f.enableMoveAllGraphics)},A.ViewEventPriorities.WIDGET)],r=this._getHandlesForComponent(e,d);return e});return function(c,d,b){return a.apply(this,arguments)}}();p._setupReshape3DOperation=
function(){var a=y._asyncToGenerator(function*(c,d,b,f=!1){var e=this;const h=yield this._requireModule(new Promise((l,k)=>E(["../../views/3d/interactive/editingTools"],l,k)));if(C(h))return h;this.snappingOptions.enabledToggled=!1;const g=new h.module.GraphicReshapeTool({view:b,graphic:c,enableZVertex:d.enableZ&&"move"===d.reshapeOptions.vertexOperation,enableZShape:d.enableZ&&"move"===d.reshapeOptions.shapeOperation,enableMoveGraphic:"move"===d.reshapeOptions.shapeOperation||"move-xy"===d.reshapeOptions.shapeOperation,
enableMidpoints:"split"===d.reshapeOptions.edgeOperation,enableEdgeOffset:"offset"===d.reshapeOptions.edgeOperation,snappingManager:this._snappingManager});b.tools.add(g);f||this.updateGraphics.add(c);const r=[],n=new J.UpdateOperationHandle({activeComponent:g,tool:"reshape",type:"update",onEnd:()=>{var l;r.forEach(k=>k.remove());r.length=0;null==(l=this.view.tools)?void 0:l.remove(g);g.destroyed||g.destroy()},canUndo:()=>g.canUndo,undo:()=>{g.undo();this._emitUndoEvent({graphics:this.updateGraphics.toArray(),
tool:"reshape"})},canRedo:()=>g.canRedo,redo:()=>{g.redo();this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:"reshape"})},addToSelection:function(){var l=y._asyncToGenerator(function*(k){e.updateGraphics.add(k);e.emit("update",{graphics:e.updateGraphics.toArray(),state:"active",aborted:!1,tool:e.activeTool,toolEventInfo:{added:[k],removed:[],type:"selection-change"},type:"update"});k=yield e._setupMove3DOperation(e.updateGraphics.toArray(),d,b,"transform",!0);C(k)||(n.onEnd(),n.destroy(),
e._setUpdateOperationHandle(k,d))});return function(k){return l.apply(this,arguments)}}(),removeFromSelection:l=>{this.updateGraphics.remove(l);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"});n.complete()},toggleTool:function(){var l=y._asyncToGenerator(function*(){if(!1!==d.toggleToolOnClick){var k=yield e._setupGraphicTransform3DOperation(e.updateGraphics.toArray(),
d,b,!0);C(k)||(n.onEnd(),n.destroy(),e._setUpdateOperationHandle(k,d))}});return function(){return l.apply(this,arguments)}}()});r.push(...this._getHandlesForComponent(n,d),b.on("immediate-click",l=>this._getCommonUpdateOperationClickHandlers(n,l,d),A.ViewEventPriorities.WIDGET),b.on("key-down",l=>{this._getCommonUpdateOperationKeyDownHandlers(n,l);l.key===z.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!0,l.stopPropagation())},A.ViewEventPriorities.WIDGET),b.on("key-up",l=>{l.key===
z.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!1,l.stopPropagation())},A.ViewEventPriorities.WIDGET));return n});return function(c,d,b){return a.apply(this,arguments)}}();p._setupTransformOrReshapeOperation=function(){var a=y._asyncToGenerator(function*(c,d,b,f){var e=this;const {multipleSelectionEnabled:h}=b;this.updateGraphics.addMany(c);c="transform"===d?yield this._getBox(c,b,f):yield this._getReshape(c,b,f);if(C(c))return c;const g=new J.UpdateOperationHandle({activeComponent:c,
type:"update",onEnd:()=>{n.forEach(l=>l.remove());r.forEach(l=>l.remove());n=[];r=[];g.activeComponent&&!g.activeComponent.destroyed&&g.activeComponent.destroy();this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{L(g,this.updateGraphics.toArray());g.refreshComponent();this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:g.tool})},redo:()=>{M(g,this.updateGraphics.toArray());g.refreshComponent();this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:g.tool})},
addToSelection:function(){var l=y._asyncToGenerator(function*(k){var m=g.activeComponent;if("reshape"===m.type){m=[...e.updateGraphics,k];e.updateGraphics.removeAll();m=yield e._setupMoveOperation(m,b,f);if(C(m))return;g.onEnd();g.destroy();e._setUpdateOperationHandle(m,b)}else e.updateGraphics.add(k),m.graphics=e.updateGraphics.toArray(),m.refresh(),g.resetHistory();e.emit("update",{graphics:e.updateGraphics.toArray(),state:"active",aborted:!1,tool:e.activeTool,toolEventInfo:{added:[k],removed:[],
type:"selection-change"},type:"update"})});return function(k){return l.apply(this,arguments)}}(),removeFromSelection:function(){var l=y._asyncToGenerator(function*(k){const m=e.updateGraphics.indexOf(k);g.history.undo.forEach(u=>u.updates.splice(m,1));g.history.redo.forEach(u=>u.updates.splice(m,1));e.updateGraphics.remove(k);const w=e.updateGraphics.toArray();if(0===w.length)g.complete();else{const u=w[0].geometry;1!==w.length||!q.isSome(u)||"point"!==u.type&&"multipoint"!==u.type?g.activeComponent.graphics=
w:g.toggleTool()}e.emit("update",{graphics:w,state:"active",aborted:!1,tool:e.activeTool,toolEventInfo:{added:[],removed:[k],type:"selection-change"},type:"update"})});return function(k){return l.apply(this,arguments)}}(),toggleTool:function(){var l=y._asyncToGenerator(function*(){if(!(1<e.updateGraphics.length)){var k=e.updateGraphics.getItemAt(0),m=k.geometry;q.isSome(m)&&("reshape"===g.tool&&("point"===m.type||"multipoint"===m.type)||"transform"===g.tool&&"extent"===m.type)||(m=null,"transform"===
g.tool?m=yield e._getReshape([k],b,f):"reshape"===g.tool&&(m=yield e._getBox([k],b,f)),C(m)||(g.activeComponent.destroy(),g.activeComponent=m,g.activeComponent&&(n.forEach(w=>w.remove()),n=e._getHandlesForComponent(g,b))))}});return function(){return l.apply(this,arguments)}}()});let r=[f.on("immediate-click",function(){var l=y._asyncToGenerator(function*(k){var m;const w=yield k.async(()=>e._getFirstHit(R.createScreenPointFromEvent(k)));null!=(m=w.results)&&m.length?w.results.some(u=>{if(u.graphic){var D;
u=u.graphic;if(null!=(D=k.native)&&D.shiftKey&&h)return k.stopPropagation(),g.addToSelection(u),!0;if(u.layer===e.layer)return g.complete(),!0}return!1}):g.complete()});return function(k){return l.apply(this,arguments)}}(),A.ViewEventPriorities.WIDGET),f.on("key-down",l=>{this._getCommonUpdateOperationKeyDownHandlers(g,l);l.key!==z.SKETCH_KEYS.snappingToggle||l.repeat||(this.snappingOptions.enabledToggled=!0,l.stopPropagation());l.key===z.SKETCH_KEYS.constraint&&!l.repeat&&g&&(l=g.activeComponent)&&
"box"===l.type&&(l.preserveAspectRatio=!l.preserveAspectRatio)},A.ViewEventPriorities.WIDGET),f.on("key-up",l=>{var k;l.key===z.SKETCH_KEYS.snappingToggle&&"reshape"===(null==g?void 0:null==(k=g.activeComponent)?void 0:k.type)&&(this.snappingOptions.enabledToggled=!1,l.stopPropagation());l.key===z.SKETCH_KEYS.constraint&&g&&(l=g.activeComponent)&&"box"===l.type&&(l.preserveAspectRatio=!l.preserveAspectRatio)},A.ViewEventPriorities.WIDGET)],n=this._getHandlesForComponent(g,b);return g});return function(c,
d,b,f){return a.apply(this,arguments)}}();p._getGraphicMover=function(){var a=y._asyncToGenerator(function*(c,d,b){({enableMoveAllGraphics:d}=d);const f=yield this._requireModule(new Promise((e,h)=>E(["../../views/draw/support/GraphicMover"],g=>e(N(g)),h)));return C(f)?f:new f.module.default({enableMoveAllGraphics:d,graphics:c,view:b,callbacks:{onGraphicMoveStart:({dx:e,dy:h,graphic:g})=>{this._displayGrabbingCursor();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,
tool:this.activeTool,toolEventInfo:{dx:e,dy:h,mover:g,type:"move-start"},type:"update"})},onGraphicMove:({dx:e,dy:h,graphic:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:h,mover:g,type:"move"},type:"update"}),onGraphicMoveStop:({dx:e,dy:h,graphic:g})=>{this._displayPointerCursor();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:h,
mover:g,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})});return function(c,d,b){return a.apply(this,arguments)}}();p._getBox=function(){var a=y._asyncToGenerator(function*(c,d,b){const {enableRotation:f,enableScaling:e,preserveAspectRatio:h}=d;d=yield this._requireModule(new Promise((g,r)=>E(["../../views/draw/support/Box"],n=>g(N(n)),r)));return C(d)?d:new d.module.default({graphics:c,enableRotation:f,
enableScaling:e,preserveAspectRatio:h,layer:this._internalGraphicsLayer,view:b,callbacks:{onMoveStart:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),onMove:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),onMoveStop:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,
toolEventInfo:{...g},type:"update"}),onScaleStart:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),onScale:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),onScaleStop:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),
onRotateStart:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),onRotate:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),onRotateStop:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"})}})});return function(c,d,b){return a.apply(this,
arguments)}}();p._getReshape=function(){var a=y._asyncToGenerator(function*(c,d,b){var f,e;const h="split"===(null==(f=d.reshapeOptions)?void 0:f.edgeOperation);d="move"===(null==(e=d.reshapeOptions)?void 0:e.shapeOperation);e=yield this._requireModule(new Promise((g,r)=>E(["../../views/draw/support/Reshape"],n=>g(N(n)),r)));return C(e)?e:new e.module.default({enableMidpoints:h,enableMovement:d,graphic:c[0],layer:this._internalGraphicsLayer,snappingManager:this._snappingManager,view:b,callbacks:{onReshapeStart:g=>
this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),onReshape:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),onReshapeStop:({mover:g,type:r})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:g,type:r},type:"update"}),onMoveStart:({dx:g,
dy:r,mover:n,type:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:g,dy:r,mover:n,type:l},type:"update"}),onMove:({dx:g,dy:r,mover:n,type:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:g,dy:r,mover:n,type:l},type:"update"}),onMoveStop:({dx:g,dy:r,mover:n,type:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",
aborted:!1,tool:this.activeTool,toolEventInfo:{dx:g,dy:r,mover:n,type:l},type:"update"}),onVertexAdd:({added:g,type:r,vertices:n})=>{g=g.map(l=>U.geometryToCoordinates(l.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:g,vertices:n,type:r},type:"update"})},onVertexRemove:({removed:g,type:r,vertices:n})=>{g=g.map(l=>U.geometryToCoordinates(l.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),
state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:g,vertices:n,type:r},type:"update"})}}})});return function(c,d,b){return a.apply(this,arguments)}}();p._getHandlesForComponent=function(a,c){const d=a.activeComponent;switch(d.type){case "graphic-mover":return[d.on("graphic-click",({graphic:b,viewEvent:f})=>{var e;null!=(e=f.native)&&e.shiftKey&&(f.stopPropagation(),a.removeFromSelection(b))}),d.on("graphic-move-start",b=>a.addToHistory(G(b.allGraphics)))];case "box":return[d.on("graphic-click",
b=>this._onTransformOrReshape2DGraphicClick(a,c,b)),d.on("move-start",b=>a.addToHistory(G(b.graphics))),d.on("rotate-start",b=>a.addToHistory(G(b.graphics))),d.on("scale-start",b=>a.addToHistory(G(b.graphics)))];case "reshape":return[d.on("graphic-click",b=>this._onTransformOrReshape2DGraphicClick(a,c,b)),d.on("move-start",b=>a.addToHistory(G([b.mover]))),d.on("reshape-start",b=>a.addToHistory(G([b.graphic]))),d.on("vertex-add",b=>a.addToHistory(G([b.oldGraphic]))),d.on("vertex-remove",b=>a.addToHistory(G([b.oldGraphic])))];
case "move-3d":return[d.on("graphic-move-start",b=>{a.addToHistory(G(b.allGraphics));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:0<b.allGraphics.length?b.allGraphics[0]:null,type:"move-start"},type:"update"})}),d.on("graphic-move",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:b.dx,dy:b.dy,mover:0<b.allGraphics.length?b.allGraphics[0]:
null,type:"move"},type:"update"})}),d.on("graphic-move-stop",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:0<b.allGraphics.length?b.allGraphics[0]:null,type:"move-stop"},type:"update"})}),d.on("immediate-click",b=>{b.shiftKey?this._toggleSelection([b.graphic],a,c):a.toggleTool()})];case "transform-3d":return[d.on("record-undo",({record:b})=>{a.addToHistory({updates:[b]})}),d.on("graphic-translate-start",
b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:b.graphic,dx:b.dxScreen,dy:b.dyScreen,type:"move-start"},type:"update"})}),d.on("graphic-translate-stop",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:b.graphic,dx:b.dxScreen,dy:b.dyScreen,type:"move-stop"},type:"update"})}),d.on("graphic-rotate-start",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),
state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:b.graphic,angle:b.angle,type:"rotate-start"},type:"update"})}),d.on("graphic-rotate-stop",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:b.graphic,angle:b.angle,type:"rotate-stop"},type:"update"})}),d.on("graphic-scale-start",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:b.graphic,
xScale:b.xScale,yScale:b.yScale,type:"scale-start"},type:"update"})}),d.on("graphic-scale-stop",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:b.graphic,xScale:b.xScale,yScale:b.yScale,type:"scale-stop"},type:"update"})}),d.on("graphic-translate",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:b.graphic,dx:b.dxScreen,dy:b.dyScreen,type:"move"},
type:"update"})}),d.on("graphic-rotate",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:b.graphic,angle:b.angle,type:"rotate"},type:"update"})}),d.on("graphic-scale",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:b.graphic,xScale:b.xScale,yScale:b.yScale,type:"scale"},type:"update"})}),d.on("immediate-click",b=>{b.shiftKey?this._toggleSelection([b.graphic],
a,c):a.toggleTool()})];case "reshape-3d":return[d.on("reshape",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:b,type:"update"})}),d.on("move",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:b,type:"update"})}),d.on("vertex-add",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:b,
type:"update"})}),d.on("vertex-remove",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:b,type:"update"})}),d.on("immediate-click",b=>{b.shiftKey?this._toggleSelection([b.graphic],a,c):a.toggleTool()})]}};p._onTransformOrReshape2DGraphicClick=function(a,c,d){var b;const {graphic:f,viewEvent:e}=d;if(null!=(b=e.native)&&b.shiftKey&&f.layer===this.layer)return e.stopPropagation(),a.removeFromSelection(f);if(c.toggleToolOnClick)return e.stopPropagation(),
a.toggleTool()};p._setUpdateOperationHandle=function(a,c){this._operationHandle=a;const d=this.view.map;this._disablePopup(c);a.on("complete",()=>{if(a===this._operationHandle){const b=this.updateGraphics.toArray(),f=this._operationHandle.tool;this._operationHandle.destroy();this._operationHandle=null;this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray());this.updateGraphics.removeAll();d&&d.remove(this._internalGraphicsLayer);this._restorePopup(c);this.emit("update",{graphics:b,state:"complete",
aborted:a.cancelled,tool:f,toolEventInfo:null,type:"update"})}})};p._getCommonUpdateOperationClickHandlers=function(){var a=y._asyncToGenerator(function*(c,d,b){const f=R.createScreenPointFromEvent(d),e=(yield d.async(()=>this._getFirstHit(f))).results;e.length?d.native.shiftKey&&this._toggleSelection(e.map(h=>h.graphic),c,b)?d.stopPropagation():e.some(h=>h.graphic&&this.updateGraphics.includes(h.graphic))?d.stopPropagation():c.complete():c.complete()});return function(c,d,b){return a.apply(this,
arguments)}}();p._toggleSelection=function(a,c,d){const b=!!d.multipleSelectionEnabled;return a.some(f=>null==f?!1:b&&f.layer===this.layer?(this.updateGraphics.includes(f)?c.removeFromSelection(f):c.addToSelection(f),!0):!1)};p._getCommonUpdateOperationKeyDownHandlers=function(a,c){if(a){var d=c.key;d===z.SKETCH_KEYS.undo&&a.canUndo()?(c.stopPropagation(),a.undo()):d===z.SKETCH_KEYS.redo&&a.canRedo()?(c.stopPropagation(),a.redo()):d===z.SKETCH_KEYS.cancel?(c.stopPropagation(),a.cancel()):this.allowDeleteKey&&
z.SKETCH_KEYS.delete.includes(d)&&this._onDeleteKey(c)}};p._onDeleteKey=function(a){if(this._operationHandle&&"update"===this._operationHandle.type){var c=this.activeComponent,d=this.updateGraphics.toArray();q.isNone(c)||"reshape-3d"===c.type||"reshape"===c.type&&(1!==d.length||"point"!==q.get(d[0].geometry,"type"))||(a.stopPropagation(),this.delete())}};p._removeDefaultLayer=function(){this._internalGraphicsLayer&&(this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=
q.destroyMaybe(this._internalGraphicsLayer))};p._isComponentGraphic=function(a){const {activeComponent:c}=this;return!a||q.isNone(c)?!1:a.attributes&&a.attributes.esriSketchTool||"draw-2d"===c.type&&c.graphic===a||("box"===c.type||"reshape"===c.type)&&c.isUIGraphic(a)};p._displayPointerCursor=function(){this.view&&this.view.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")};p._displayGrabbingCursor=function(){this.view&&this.view.container&&"grabbing"!==this.view.cursor&&(this.view.cursor=
"grabbing")};p._displayDefaultCursor=function(){this.view&&this.view.container&&null!==this.view.cursor&&(this.view.cursor=null)};p._logError=function(a,c,d){pa.error(new ca(a,c,d))};p._requireModule=function(){var a=y._asyncToGenerator(function*(c){const d=new AbortController;this._moduleLoaderAbortController=d;c=yield c;return this._moduleLoaderAbortController!==d||d.signal.aborted?{requireError:"aborted"}:{module:c}});return function(c){return a.apply(this,arguments)}}();p._emitUndoEvent=function(a){this.emit("undo",
{...a,type:"undo"})};p._emitRedoEvent=function(a){this.emit("redo",{...a,type:"redo"})};p._emitDeleteEvent=function(a){this.emit("delete",{...a,type:"delete"})};p.test=function(){return{operationHandle:this._operationHandle,defaultUpdateOptions:O}};p.wait=function(){return H.whenNotOnce(this,"updating")};p._beginAsyncOperation=function(){this._numUpdating+=1;this.notifyChange("updating")};p._endAsyncOperation=function(){--this._numUpdating;this.notifyChange("updating")};p._disablePopupEnabled=function(a){var c;
return"3d"!==(null==(c=this.view)?void 0:c.type)||this.updateOnGraphicClick||q.isSome(a)&&a.toggleToolOnClick};p._disablePopup=function(a){this._disablePopupEnabled(a)&&(a=this.view.popup)&&q.isNone(this._originalAutoOpenEnabled)&&(this._originalAutoOpenEnabled=a.autoOpenEnabled,a.autoOpenEnabled=!1)};p._restorePopup=function(a){this._disablePopupEnabled(a)&&(a=this.view.popup)&&q.isSome(this._originalAutoOpenEnabled)&&(a.autoOpenEnabled=this._originalAutoOpenEnabled,this._originalAutoOpenEnabled=
null)};p._waitViewReady=function(){var a=y._asyncToGenerator(function*(){this.view&&(q.abortMaybe(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,yield P.whenOrAbort(H.whenOnce(this.view,"ready"),this._viewReadyAbortController.signal))});return function(){return a.apply(this,arguments)}}();y._createClass(F,[{key:"_defaultUpdateTool",get:function(){return"3d"===this.view.type?"move":"transform"}},{key:"updating",get:function(){return 0<this._numUpdating}},{key:"activeTool",
get:function(){return this._operationHandle&&this._operationHandle.tool?this._operationHandle.tool:null}},{key:"activeComponent",get:function(){return this._operationHandle?this._operationHandle.activeComponent:null}},{key:"createGraphic",get:function(){return!q.isSome(this.activeComponent)||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):q.unwrap(this.activeComponent.graphic)}},{key:"defaultCreateOptions",set:function(a){this._set("defaultCreateOptions",
{...aa,...a})}},{key:"defaultUpdateOptions",set:function(a){this._set("defaultUpdateOptions",{...O,...a,reshapeOptions:{...O.reshapeOptions,...null==a?void 0:a.reshapeOptions}})}},{key:"snappingOptions",set:function(a){q.isSome(this._snappingManager)&&(this._snappingManager.options=a);this._set("snappingOptions",a)}},{key:"state",get:function(){var a;const c=!(null==(a=this.view)||!a.ready||!this.layer);a=this._operationHandle;return c&&a?"active":c?"ready":"disabled"}},{key:"view",get:function(){return this._get("view")},
set:function(a){const c=this._get("view");if(c){const {container:d,map:b}=c;d&&(c.cursor=null);b&&b.remove(this._internalGraphicsLayer);this._viewHandles.removeAll();this.cancel()}this._handles.remove("view-ready");a&&this._handles.add(H.when(a,"ready",d=>{this._viewHandles.removeAll();d&&this._viewHandles.add(this._generateViewHandles(a))},!0),"view-ready");this._set("view",a)}}]);return F}(da.EventedAccessor);v.__decorate([x.property()],t.prototype,"updating",null);v.__decorate([x.property()],t.prototype,
"_operationHandle",void 0);v.__decorate([x.property({readOnly:!0})],t.prototype,"activeTool",null);v.__decorate([x.property()],t.prototype,"activeFillSymbol",void 0);v.__decorate([x.property()],t.prototype,"activeLineSymbol",void 0);v.__decorate([x.property()],t.prototype,"activeVertexSymbol",void 0);v.__decorate([x.property()],t.prototype,"allowDeleteKey",void 0);v.__decorate([x.property({readOnly:!0})],t.prototype,"createGraphic",null);v.__decorate([x.property()],t.prototype,"defaultCreateOptions",
null);v.__decorate([x.property()],t.prototype,"defaultUpdateOptions",null);v.__decorate([x.property()],t.prototype,"layer",void 0);v.__decorate([x.property({types:I.symbolTypes})],t.prototype,"pointSymbol",void 0);v.__decorate([x.property({types:I.symbolTypes})],t.prototype,"polygonSymbol",void 0);v.__decorate([x.property({types:I.symbolTypes})],t.prototype,"polylineSymbol",void 0);v.__decorate([x.property({type:W,nonNullable:!0})],t.prototype,"snappingOptions",null);v.__decorate([x.property()],t.prototype,
"_snappingManager",void 0);v.__decorate([x.property({readOnly:!0})],t.prototype,"state",null);v.__decorate([x.property({readOnly:!0})],t.prototype,"updateGraphics",void 0);v.__decorate([x.property()],t.prototype,"updateOnGraphicClick",void 0);v.__decorate([x.property({types:I.symbolTypes})],t.prototype,"updatePointSymbol",void 0);v.__decorate([x.property({types:I.symbolTypes})],t.prototype,"updatePolygonSymbol",void 0);v.__decorate([x.property({types:I.symbolTypes})],t.prototype,"updatePolylineSymbol",
void 0);v.__decorate([x.property({types:I.symbolTypes})],t.prototype,"vertexSymbol",void 0);v.__decorate([x.property({value:null})],t.prototype,"view",null);v.__decorate([x.property()],t.prototype,"cancel",null);v.__decorate([x.property()],t.prototype,"complete",null);v.__decorate([x.property()],t.prototype,"delete",null);v.__decorate([x.property()],t.prototype,"create",null);v.__decorate([x.property()],t.prototype,"update",null);v.__decorate([x.property()],t.prototype,"undo",null);v.__decorate([x.property()],
t.prototype,"redo",null);v.__decorate([x.property()],t.prototype,"canUndo",null);v.__decorate([x.property()],t.prototype,"canRedo",null);v.__decorate([x.property()],t.prototype,"toggleUpdateTool",null);return t=v.__decorate([ha.subclass("esri.widgets.Sketch.SketchViewModel")],t)});