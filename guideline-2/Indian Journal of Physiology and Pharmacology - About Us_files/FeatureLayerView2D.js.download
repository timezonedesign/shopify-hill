// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
require({cache:{"esri/AggregateGraphic":function(){define("./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./Graphic ./core/accessorSupport/decorators/property ./core/arrayUtils ./core/has ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/subclass".split(" "),function(f,q,g,w,u,l,m,n){var k;g=k=function(t){function h(){var r=t.apply(this,arguments)||this;r.isAggregate=!0;return r}f._inheritsLoose(h,t);var x=h.prototype;x.getEffectivePopupTemplate=function(r){return this.popupTemplate?
this.popupTemplate:(r=this.sourceLayer&&this.sourceLayer.featureReduction)&&"popupTemplate"in r&&r.popupEnabled?r.popupTemplate:null};x.getObjectId=function(){return this.objectId};x.clone=function(){return new k({objectId:this.objectId,...this.cloneProperties()})};return h}(g);q.__decorate([w.property({type:Boolean})],g.prototype,"isAggregate",void 0);q.__decorate([w.property({type:Number,json:{read:!0}})],g.prototype,"objectId",void 0);return g=k=q.__decorate([n.subclass("esri.AggregateGraphic")],
g)})},"esri/layers/effects/FeatureEffectView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/has ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./EffectView".split(" "),function(f,q,g,w,u,l,m,n,k,t){g=function(h){function x(e){var d=h.call(this,e)||this;d._filter=null;d.duration=w("mapview-transitions-duration");
d._excludedEffectView=new t.default(e);d._includedEffectView=new t.default(e);return d}f._inheritsLoose(x,h);var r=x.prototype;r.transitionStep=function(e,d){this._set("scale",d);this.transitioning?(this._includedEffectView.transitionStep(e,d),this._excludedEffectView.transitionStep(e,d),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=d,this._includedEffectView.scale=d)};r.end=function(){this._includedEffectView.end();this._excludedEffectView.end();this._filter=null};r._transitionTo=
function(e){const d=this._get("featureEffect");e=u.unwrap(e);const v=u.unwrap(null==e?void 0:e.includedEffect),B=u.unwrap(null==e?void 0:e.excludedEffect),C=this._includedEffectView.canTransitionTo(v)&&this._excludedEffectView.canTransitionTo(B);this._includedEffectView.effect=v;this._excludedEffectView.effect=B;this._set("featureEffect",e);this._filter=(null==e?void 0:e.filter)||(null==d?void 0:d.filter)||null;C||this.end()};f._createClass(x,[{key:"excludedEffects",get:function(){return this._excludedEffectView.effects}},
{key:"featureEffect",set:function(e){this._get("featureEffect")!==e&&this._transitionTo(e)}},{key:"filter",get:function(){var e;return this._filter||(null==(e=u.unwrap(this.featureEffect))?void 0:e.filter)||null}},{key:"hasEffects",get:function(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}},{key:"includedEffects",get:function(){return this._includedEffectView.effects}},{key:"scale",set:function(e){this._set("scale",e);this._excludedEffectView.scale=e;this._includedEffectView.scale=
e}},{key:"transitioning",get:function(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}}]);return x}(g);q.__decorate([l.property()],g.prototype,"_filter",void 0);q.__decorate([l.property()],g.prototype,"_excludedEffectView",void 0);q.__decorate([l.property()],g.prototype,"_includedEffectView",void 0);q.__decorate([l.property()],g.prototype,"duration",void 0);q.__decorate([l.property()],g.prototype,"excludedEffects",null);q.__decorate([l.property()],g.prototype,
"featureEffect",null);q.__decorate([l.property()],g.prototype,"filter",null);q.__decorate([l.property()],g.prototype,"hasEffects",null);q.__decorate([l.property()],g.prototype,"includedEffects",null);q.__decorate([l.property({value:0})],g.prototype,"scale",null);q.__decorate([l.property()],g.prototype,"transitioning",null);return g=q.__decorate([k.subclass("esri.layers.effects.FeatureEffectView")],g)})},"esri/renderers/support/clickToleranceUtils":function(){define(["exports"],function(f){function q(u,
l){return l?"xoffset"in l&&l.xoffset?Math.max(u,Math.abs(l.xoffset)):"yoffset"in l&&l.yoffset?Math.max(u,Math.abs(l.yoffset||0)):u:u}function g(u,l){if("number"===typeof u)return u;if(u&&u.stops&&u.stops.length){{u=u.stops;let m=l=0;for(let n=0;n<u.length;n++){const k=u[n].size;"number"===typeof k&&(l+=k,m++)}u=l/m}return u}return l}function w(u,l){if(!l)return u;l=l.filter(k=>"size"===k.type).map(k=>{const {maxSize:t,minSize:h}=k;return(g(t,u)+g(h,u))/2});let m=0;const n=l.length;if(0===n)return u;
for(let k=0;k<n;k++)m+=l[k];return Math.max(Math.floor(m/n),u)}f.calculateTolerance=function(u){const l=u&&u.renderer;u="touch"===(u&&u.event&&u.event.pointerType)?9:6;if(!l)return u;u="visualVariables"in l?w(u,l.visualVariables):u;if("simple"===l.type)return q(u,l.symbol);if("unique-value"===l.type){let m=u;l.uniqueValueInfos.forEach(n=>{m=q(m,n.symbol)});return m}if("class-breaks"===l.type){let m=u;l.classBreakInfos.forEach(n=>{m=q(m,n.symbol)});return m}return u};Object.defineProperty(f,"__esModule",
{value:!0})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(f,q,g,w,u,l,m,n,k,t,h,x,r,e,d,v){const B=w.ofType({key:"type",base:r,typeMap:{rect:e,path:v,geometry:d}});f.LayerView2DMixin=C=>{C=function(F){function M(){var J=F.apply(this,arguments)||this;J.clips=new B;J.moving=!1;J.attached=!1;J.lastUpdateId=-1;J.updateRequested=!1;return J}q._inheritsLoose(M,F);var K=M.prototype;K.initialize=function(){var J;this.container||(this.container=new x.Container);this.container.fadeTransitionEnabled=!0;this.container.opacity=0;this.container.clips=this.clips;
this.handles.add([l.init(this,"suspended",H=>{this.container&&(this.container.visible=!H);this.view&&!H&&this.updateRequested&&this.view.requestUpdate()},!0),l.init(this,["layer.opacity","container"],()=>{if(this.container){var H,G;this.container.opacity=null!=(H=null==(G=this.layer)?void 0:G.opacity)?H:1}},!0),l.init(this,["layer.blendMode"],H=>{this.container&&(this.container.blendMode=H)},!0),l.init(this,["layer.effect"],H=>{this.container&&(this.container.effect=H)},!0),this.clips.on("change",
()=>{this.container.clips=this.clips;this.notifyChange("clips")})]);null!=(J=this.view)&&J.whenLayerView?this.view.whenLayerView(this.layer).then(H=>{H!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})};K.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};K.isVisibleAtScale=
function(J){var H=!0,G=this.layer;const aa=G.minScale;G=G.maxScale;if(null!=aa&&null!=G){H=!aa;let Z=!G;!H&&J<=aa&&(H=!0);!Z&&J>=G&&(Z=!0);H=H&&Z}return H};K.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};K.processUpdate=function(J){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",J),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(J)))};K.hitTest=
function(J,H){return Promise.resolve(null)};K.isUpdating=function(){return!1};K.isRendering=function(){return!1};K.canResume=function(){return F.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};q._createClass(M,[{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(!this.updatingHandles||!this.updatingHandles.updating)}}]);return M}(C);g.__decorate([m.property({type:B,set(F){F=u.referenceSetter(F,this._get("clips"),
B);this._set("clips",F)}})],C.prototype,"clips",void 0);g.__decorate([m.property()],C.prototype,"moving",void 0);g.__decorate([m.property()],C.prototype,"attached",void 0);g.__decorate([m.property()],C.prototype,"container",void 0);g.__decorate([m.property()],C.prototype,"suspended",void 0);g.__decorate([m.property({readOnly:!0})],C.prototype,"updateParameters",void 0);g.__decorate([m.property()],C.prototype,"updateRequested",void 0);g.__decorate([m.property()],C.prototype,"updating",null);g.__decorate([m.property()],
C.prototype,"view",void 0);return C=g.__decorate([h.subclass("esri.views.2d.layers.LayerView2D")],C)};Object.defineProperty(f,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/set ../../../core/accessorSupport/decorators/subclass".split(" "),
function(f,q,g,w,u,l,m,n,k){g=function(t){function h(){return t.apply(this,arguments)||this}f._inheritsLoose(h,t);return h}(g.JSONSupport);return g=q.__decorate([k.subclass("esri.views.layers.support.ClipArea")],g)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(f,q,g,w,u,l,m,n){var k;w=k=function(t){function h(){var x=t.apply(this,arguments)||this;x.type="rect";x.left=null;x.right=null;x.top=null;x.bottom=null;return x}f._inheritsLoose(h,t);h.prototype.clone=function(){return new k({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};f._createClass(h,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return h}(n);q.__decorate([g.property({type:[Number,String],json:{write:!0}})],w.prototype,"left",void 0);q.__decorate([g.property({type:[Number,
String],json:{write:!0}})],w.prototype,"right",void 0);q.__decorate([g.property({type:[Number,String],json:{write:!0}})],w.prototype,"top",void 0);q.__decorate([g.property({type:[Number,String],json:{write:!0}})],w.prototype,"bottom",void 0);q.__decorate([g.property({readOnly:!0})],w.prototype,"version",null);return w=k=q.__decorate([m.subclass("esri.views.layers.support.ClipRect")],w)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(f,q,g,w,u,l,m,n,k,t,h,x,r){var e;g={base:k,key:"type",typeMap:{extent:x,polygon:r}};h=e=function(d){function v(){var B=d.apply(this,arguments)||this;B.type="geometry";B.geometry=null;return B}f._inheritsLoose(v,d);v.prototype.clone=function(){return new e({geometry:this.geometry.clone()})};f._createClass(v,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return v}(h);q.__decorate([w.property({types:g,json:{read:t.fromJSON,write:!0}})],h.prototype,"geometry",void 0);q.__decorate([w.property({readOnly:!0})],
h.prototype,"version",null);return h=e=q.__decorate([n.subclass("esri.views.layers.support.Geometry")],h)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(f,q,g,w,u,l,m,n){w=function(k){function t(){var h=k.apply(this,
arguments)||this;h.type="path";h.path=[];return h}f._inheritsLoose(t,k);f._createClass(t,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return t}(n);q.__decorate([g.property({type:[[[Number]]],json:{write:!0}})],w.prototype,"path",void 0);q.__decorate([g.property({readOnly:!0})],w.prototype,"version",null);return w=q.__decorate([m.subclass("esri.views.layers.support.Path")],w)})},"esri/views/2d/layers/features/tileRenderers":function(){define(["require","exports","../../../../chunks/_rollupPluginBabelHelpers"],
function(f,q,g){function w(){w=g._asyncToGenerator(function*(u,l){if(!u)return null;switch(u.type){case "class-breaks":case "simple":case "unique-value":case "dot-density":case "dictionary":return new (yield new Promise((m,n)=>f(["./tileRenderers/SymbolTileRenderer"],k=>m(Object.freeze({__proto__:null,default:k})),n))).default(l);case "heatmap":return new (yield new Promise((m,n)=>f(["./tileRenderers/HeatmapTileRenderer"],k=>m(Object.freeze({__proto__:null,default:k})),n))).default(l)}});return w.apply(this,
arguments)}q.createOrReuseTileRenderer=function(u,l){return w.apply(this,arguments)};Object.defineProperty(q,"__esModule",{value:!0})})},"esri/views/2d/layers/support/FeatureCommandQueue":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../support/QueueProcessor".split(" "),
function(f,q,g,w,u,l,m,n,k){function t(e){return e.some(d=>d.globalId)}function h(e){return e.filter(d=>!d.error).map(d=>{var v;return null!=(v=d.objectId)?v:d.globalId})}function x(e,d){e=new Set(e);for(const v of d.values())e.add(v);return e}function r(e,d){e=new Set(e);for(const v of d.values())e.delete(v);return e}g=function(e){function d(B){B=e.call(this,B)||this;B._hasGlobalIds=!1;return B}f._inheritsLoose(d,e);var v=d.prototype;v.normalizeCtorArgs=function(B){this._queueProcessor=new k.QueueProcessor({concurrency:1,
process:B.process});return{}};v.destroy=function(){this._queueProcessor.clear()};v.push=function(B){const C=this._queueProcessor;var F=C.last();switch(B.type){case "update":case "refresh":if((null==F?void 0:F.type)===B.type)return;C.push(B).finally(()=>this.notifyChange("updating"));break;case "edit":(F="processed-edit"===(null==F?void 0:F.type)?F:null)&&C.popLast();B=this._mergeEdits(F,B);for(const M of B)C.push(M).finally(()=>this.notifyChange("updating"))}this.notifyChange("updating")};v._mergeEdits=
function(B,C){var F,M;const {addedFeatures:K,deletedFeatures:J,updatedFeatures:H}=C.edits;if(this._hasGlobalIds=this._hasGlobalIds||t(K)||t(H)||t(J))return C=[...K,...H],[B,{type:"processed-edit",edits:{addOrModified:C,removed:J}}];C=new Set(h(null!=(F=null==B?void 0:B.edits.addOrModified)?F:[]));B=new Set(h(null!=(M=null==B?void 0:B.edits.removed)?M:[]));M=new Set([...h(K),...h(H)]);F=new Set(h(J));C=Array.from(x(r(C,F),M)).map(G=>({objectId:G}));B=Array.from(x(r(B,M),F)).map(G=>({objectId:G}));
return[{type:"processed-edit",edits:{addOrModified:C,removed:B}}]};f._createClass(d,[{key:"updating",get:function(){return 0<this._queueProcessor.length}}]);return d}(g);q.__decorate([w.property({readOnly:!0})],g.prototype,"updating",null);return g=q.__decorate([n.subclass("esri.views.2d.layers.support.FeatureCommandQueue")],g)})},"esri/views/2d/layers/support/FeatureLayerProxy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Promise ../../../../core/promiseUtils ../../../../core/workers/workers ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(f,q,g,w,u,l,m,n,k,t){g=function(h){function x(e){e=h.call(this,e)||this;e._startupResolver=w.createResolver();e.isReady=!1;return e}f._inheritsLoose(x,h);var r=x.prototype;r.initialize=function(){this._controller=new AbortController;this.addResolvingPromise(this._startWorker(this._controller.signal))};r.destroy=function(){this._controller.abort();this._connection&&this._connection.close()};r.startup=function(){var e=f._asyncToGenerator(function*(d,v,B,C){yield this.when();var F=this._controller.signal;
F=Array.isArray(B.source)?{transferList:B.source,signal:F}:void 0;d=d.tileInfo.toJSON();yield this._connection.invoke("startup",{service:B,config:v,tileInfo:d,tiles:C},F);this._startupResolver.resolve();this._set("isReady",!0)});return function(d,v,B,C){return e.apply(this,arguments)}}();r.updateTiles=function(){var e=f._asyncToGenerator(function*(d){yield this._startupResolver.promise;return w.ignoreAbortErrors(this._connection.invoke("updateTiles",d))});return function(d){return e.apply(this,arguments)}}();
r.update=function(){var e=f._asyncToGenerator(function*(d){d={config:d};yield this._startupResolver.promise;return this._connection.invoke("update",d)});return function(d){return e.apply(this,arguments)}}();r.applyUpdate=function(){var e=f._asyncToGenerator(function*(d){yield this._startupResolver.promise;return this._connection.invoke("applyUpdate",d)});return function(d){return e.apply(this,arguments)}}();r.setHighlight=function(){var e=f._asyncToGenerator(function*(d){yield this._startupResolver.promise;
return w.ignoreAbortErrors(this._connection.invoke("controller.setHighlight",d))});return function(d){return e.apply(this,arguments)}}();r.refresh=function(){var e=f._asyncToGenerator(function*(d){yield this._startupResolver.promise;return w.ignoreAbortErrors(this._connection.invoke("controller.refresh",d))});return function(d){return e.apply(this,arguments)}}();r.querySummaryStatistics=function(){var e=f._asyncToGenerator(function*(d,v,B){yield this._startupResolver.promise;return this._connection.invoke("controller.querySummaryStatistics",
{query:d.toJSON(),params:v},B)});return function(d,v,B){return e.apply(this,arguments)}}();r.queryUniqueValues=function(){var e=f._asyncToGenerator(function*(d,v,B){yield this._startupResolver.promise;return this._connection.invoke("controller.queryUniqueValues",{query:d.toJSON(),params:v},B)});return function(d,v,B){return e.apply(this,arguments)}}();r.queryClassBreaks=function(){var e=f._asyncToGenerator(function*(d,v,B){yield this._startupResolver.promise;return this._connection.invoke("controller.queryClassBreaks",
{query:d.toJSON(),params:v},B)});return function(d,v,B){return e.apply(this,arguments)}}();r.queryHistogram=function(){var e=f._asyncToGenerator(function*(d,v,B){yield this._startupResolver.promise;return this._connection.invoke("controller.queryHistogram",{query:d.toJSON(),params:v},B)});return function(d,v,B){return e.apply(this,arguments)}}();r.queryFeatures=function(){var e=f._asyncToGenerator(function*(d,v){yield this._startupResolver.promise;return this._connection.invoke("controller.queryFeatures",
d.toJSON(),v)});return function(d,v){return e.apply(this,arguments)}}();r.queryVisibleFeatures=function(){var e=f._asyncToGenerator(function*(d,v){yield this._startupResolver.promise;return this._connection.invoke("controller.queryVisibleFeatures",d.toJSON(),v)});return function(d,v){return e.apply(this,arguments)}}();r.queryObjectIds=function(){var e=f._asyncToGenerator(function*(d,v){yield this._startupResolver.promise;return this._connection.invoke("controller.queryObjectIds",d.toJSON(),v)});return function(d,
v){return e.apply(this,arguments)}}();r.queryFeatureCount=function(){var e=f._asyncToGenerator(function*(d,v){yield this._startupResolver.promise;return this._connection.invoke("controller.queryFeatureCount",d.toJSON(),v)});return function(d,v){return e.apply(this,arguments)}}();r.queryExtent=function(){var e=f._asyncToGenerator(function*(d,v){return this._connection.invoke("controller.queryExtent",d.toJSON(),v)});return function(d,v){return e.apply(this,arguments)}}();r.queryLatestObservations=function(){var e=
f._asyncToGenerator(function*(d,v){yield this._startupResolver.promise;return this._connection.invoke("controller.queryLatestObservations",d.toJSON(),v)});return function(d,v){return e.apply(this,arguments)}}();r.queryStatistics=function(){var e=f._asyncToGenerator(function*(d){yield this._startupResolver.promise;return this._connection.invoke("controller.queryStatistics",d)});return function(d){return e.apply(this,arguments)}}();r.getObjectId=function(){var e=f._asyncToGenerator(function*(d){yield this._startupResolver.promise;
return this._connection.invoke("controller.getObjectId",d)});return function(d){return e.apply(this,arguments)}}();r.getDisplayId=function(){var e=f._asyncToGenerator(function*(d){yield this._startupResolver.promise;return this._connection.invoke("controller.getDisplayId",d)});return function(d){return e.apply(this,arguments)}}();r.getFeatures=function(){var e=f._asyncToGenerator(function*(d){yield this._startupResolver.promise;return this._connection.invoke("controller.getFeatures",d)});return function(d){return e.apply(this,
arguments)}}();r.getAggregates=function(){var e=f._asyncToGenerator(function*(){yield this._startupResolver.promise;return this._connection.invoke("controller.getAggregates")});return function(){return e.apply(this,arguments)}}();r.getAggregateValueRanges=function(){var e=f._asyncToGenerator(function*(){yield this._startupResolver.promise;return this._connection.invoke("controller.getAggregateValueRanges")});return function(){return e.apply(this,arguments)}}();r.mapValidDisplayIds=function(){var e=
f._asyncToGenerator(function*(d){yield this._startupResolver.promise;return this._connection.invoke("controller.mapValidDisplayIds",d)});return function(d){return e.apply(this,arguments)}}();r.onEdits=function(){var e=f._asyncToGenerator(function*(d){yield this._startupResolver.promise;return w.ignoreAbortErrors(this._connection.invoke("controller.onEdits",d))});return function(d){return e.apply(this,arguments)}}();r.enableEvent=function(){var e=f._asyncToGenerator(function*(d,v){yield this._startupResolver.promise;
return w.ignoreAbortErrors(this._connection.invoke("controller.enableEvent",{name:d,value:v}))});return function(d,v){return e.apply(this,arguments)}}();r._startWorker=function(){var e=f._asyncToGenerator(function*(d){try{this._connection=yield u.open("Pipeline",{client:this.client,strategy:"dedicated",signal:d})}catch(v){w.throwIfNotAbortError(v)}});return function(d){return e.apply(this,arguments)}}();f._createClass(x,[{key:"tileRenderer",set:function(e){this.client.tileRenderer=e}},{key:"closed",
get:function(){return this._connection.closed}}]);return x}(g.EsriPromise);q.__decorate([l.property()],g.prototype,"isReady",void 0);q.__decorate([l.property()],g.prototype,"client",void 0);q.__decorate([l.property()],g.prototype,"tileRenderer",null);return g=q.__decorate([t.subclass("esri.views.2d.layers.support.FeatureLayerProxy")],g)})},"esri/views/2d/tiling/TileManager":function(){define(["exports","../../../core/maybe","./TileCoverage","./TileKey"],function(f,q,g,w){let u=function(){function l(n){this._tiles=
new Map;this.buffer=0;this.acquireTile=n.acquireTile;this.releaseTile=n.releaseTile;this.tileInfoView=n.tileInfoView;this.buffer=n.buffer}var m=l.prototype;m.destroy=function(){};m.clear=function(){this._tiles.forEach(n=>this._releaseTile(n))};m.tileKeys=function(){const n=[];this._tiles.forEach((k,t)=>n.push(t));return n};m.update=function(n){n=this.tileInfoView.getTileCoverage(n.state,this.buffer,"closest");const {spans:k,lodInfo:t}=n,{level:h}=t,x=[],r=[],e=new Set,d=new Set;for(const {row:v,colFrom:B,
colTo:C}of k)for(let F=B;F<=C;F++){const M=w.getId(h,v,t.normalizeCol(F),t.getWorldForColumn(F)),K=this._getOrAcquireTile(x,M);e.add(M);K.isReady?K.visible=!0:d.add(K.key)}d.forEach(v=>this._addPlaceholders(e,v));this._tiles.forEach(v=>{e.has(v.key.id)||(r.push(v.key.id),this._releaseTile(v))});g.pool.release(n);return{hasMissingTiles:0<d.size,added:x,removed:r}};m._getOrAcquireTile=function(n,k){if(!this._tiles.has(k)){const t=this.acquireTile(new w(k));n.push(k);this._tiles.set(k,t);t.visible=!1}return this._tiles.get(k)};
m._getTile=function(n){return this._tiles.get(n)};m._releaseTile=function(n){this._tiles.delete(n.key.id);this.releaseTile(n)};m._addPlaceholders=function(n,k){const t=this._addPlaceholderChildren(n,k);1E-6>Math.abs(1-t)||this._addPlaceholderParent(n,k)||(this._getTile(k.id).visible=!0)};m._addPlaceholderChildren=function(n,k){let t=0;this._tiles.forEach(h=>{t+=this._addPlaceholderChild(n,h,k)});return t};m._addPlaceholderChild=function(n,k,t){if(k.key.level<=t.level||!k.hasData||!t.contains(k.key))return 0;
k.visible=!0;n.add(k.key.id);return 1/(1<<2*(k.key.level-t.level))};m._addPlaceholderParent=function(n,k){k=k.getParentKey();let t=0,h=null;for(;q.isSome(k);){if(n.has(k.id))return!0;const x=this._getTile(k.id);if(null!=x&&x.isReady)return x.visible=!0,n.add(x.key.id),!0;null!=x&&x.hasData&&x.patchCount>t&&(t=x.patchCount,h=x);k=k.getParentKey()}return h?(h.visible=!0,n.add(h.key.id),!0):!1};return l}();f.TileManager=u;Object.defineProperty(f,"__esModule",{value:!0})})},"esri/views/layers/FeatureLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/deprecate ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils ../support/floorFilterUtils".split(" "),
function(f,q,g,w,u,l,m,n,k,t,h,x,r,e,d,v,B,C,F,M,K,J){const H=l.getLogger("esri.views.layers.FeatureLayerView");l=G=>{G=function(aa){function Z(...A){A=aa.call(this,...A)||this;A._updatingRequiredFieldsPromise=null;A.filter=null;A.timeExtent=null;A.layer=null;A.requiredFields=[];A.view=null;return A}q._inheritsLoose(Z,aa);var Q=Z.prototype;Q.initialize=function(){k.init(this,"layer.renderer layer.labelingInfo layer.elevationInfo.featureExpressionInfo layer.displayField filter featureEffect layer.timeInfo layer.floorInfo timeExtent".split(" "),
()=>this._handleRequiredFieldsChange(),!0);k.on(this,"view.floors","change",()=>this._handleRequiredFieldsChange());k.on(this,"layer.sublayer","change",()=>this._handleRequiredFieldsChange())};Q.highlight=function(A){throw Error("missing implementation");};Q.createQuery=function(){var A={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};A=m.isSome(this.filter)?this.filter.createQuery(A):new F(A);if("feature"===this.layer.type){const D=J.getFloorFilterClause(this);m.isSome(D)&&
(A.where=A.where?`(${A.where}) AND (${D})`:D)}m.isSome(this.timeExtent)&&(A.timeExtent=m.isSome(A.timeExtent)?A.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return A};Q.queryFeatures=function(A,D){throw Error("missing implementation");};Q.queryObjectIds=function(A,D){throw Error("missing implementation");};Q.queryFeatureCount=function(A,D){throw Error("missing implementation");};Q.queryExtent=function(A,D){throw Error("missing implementation");};Q.fetchPopupFeatures=function(){var A=
q._asyncToGenerator(function*(D,y){if(D=this.validateFetchPopupFeatures(y))throw D;return this.fetchClientPopupFeatures(y)});return function(D,y){return A.apply(this,arguments)}}();Q._loadArcadeModules=function(A){if(A.get("expressionInfos.length")||Array.isArray(A.content)&&A.content.some(D=>"expression"===D.type))return M.loadArcade()};Q._handleRequiredFieldsChange=function(){const A=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",A);A.then(()=>{this._updatingRequiredFieldsPromise===
A&&this._set("_updatingRequiredFieldsPromise",null)})};Q._updateRequiredFields=function(){var A=q._asyncToGenerator(function*(){if(this.layer&&this.view){var D="3d"===this.view.type,{layer:y,layer:{fieldsIndex:R,objectIdField:S}}=this,N="renderer"in y&&y.renderer,O="orderBy"in y&&y.orderBy,U=y.featureReduction,I=new Set;N=yield n.eachAlways([N?N.collectRequiredFields(I,R):null,C.collectLabelingFields(I,y),D?C.collectElevationFields(I,y):null,m.isSome(this.filter)?C.collectFilterFields(I,y,this.filter):
null,m.isSome(this.featureEffect)?C.collectFilterFields(I,y,this.featureEffect.filter):null,U?C.collectFeatureReductionFields(I,y,U):null,O?C.collectOrderByInfos(I,y,O):null]);y.timeInfo&&this.timeExtent&&C.collectFields(I,y.fieldsIndex,[y.timeInfo.startField,y.timeInfo.endField]);"feature"===y.type&&y.floorInfo&&C.collectFields(I,y.fieldsIndex,[y.floorInfo.floorField]);"subtype-group"===y.type&&(C.collectField(I,R,y.subtypeField),O=y.sublayers.map(X=>{var ca;return Promise.all([null==(ca=X.renderer)?
void 0:ca.collectRequiredFields(I,R),C.collectLabelingFields(I,X)])}),yield n.eachAlways(O));for(const X of N)X.error&&H.error(X.error);C.collectField(I,R,S);D&&"displayField"in y&&y.displayField&&C.collectField(I,R,y.displayField);D=Array.from(I).sort();this._set("requiredFields",D)}});return function(){return A.apply(this,arguments)}}();Q.validateFetchPopupFeatures=function(A){if(m.isNone(A))return null;for(const D of A.clientGraphics){const y=D.layer;if("popupEnabled"in y&&!y.popupEnabled)return new u("featurelayerview:fetchPopupFeatures",
"Popups are disabled",{layer:y});if("popupTemplate"in y&&!K.getFetchPopupTemplate(y,A))return new u("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:y});if(D.isAggregate&&!(y.featureReduction&&"popupTemplate"in y.featureReduction&&y.featureReduction.popupEnabled&&y.featureReduction.popupTemplate))return new u("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:y})}};Q.fetchClientPopupFeatures=function(){var A=q._asyncToGenerator(function*(D){const y=
m.isSome(D)?D.clientGraphics:null;if(!y||0===y.length)return[];const R=Array(y.length),S=new Map,N=yield this.createPopupQuery(D);for(let U=0;U<y.length;U++){const I=y[U];if(I.isAggregate){R[U]=I;continue}var {layer:O}=I;if(!("popupEnabled"in O))continue;const X=C.unpackFieldNames(this.layer.fieldsIndex,N.outFields);O=K.getFetchPopupTemplate(O,D);if(!m.isSome(O))continue;const ca=yield this._loadArcadeModules(O);ca&&ca.arcadeUtils.hasGeometryOperations(O)||!C.featureHasFields(X,I)?S.set(I.getObjectId(),
U):R[U]=I}if("stream"===this.layer.type||0===S.size)return R.filter(Boolean);N.objectIds=Array.from(S.keys());try{const U=yield this.layer.queryFeatures(N);for(const I of U.features){const X=S.get(I.getObjectId());R[X]=I}}catch{}return R.filter(Boolean)});return function(D){return A.apply(this,arguments)}}();Q.createPopupQuery=function(){var A=q._asyncToGenerator(function*(D){const y=this.layer.createQuery(),R=new Set;var S=!1,N=m.isSome(D)&&D.clientGraphics?D.clientGraphics.map(O=>O.layer):[this.layer];
for(const O of N)if("popupEnabled"in O&&(N=K.getFetchPopupTemplate(O,D),m.isSome(N))){S=(S=yield this._loadArcadeModules(N))&&S.arcadeUtils.hasGeometryOperations(N);S=!("point"!==this.layer.geometryType&&!S);N=yield K.getRequiredFields(this.layer,N);for(const U of N)R.add(U)}y.returnGeometry=S;y.returnZ=S;y.returnM=S;y.outFields=Array.from(R);y.outSpatialReference=this.view.spatialReference;"feature"===this.layer.type&&(D=J.getFloorFilterClause(this),m.isSome(D)&&(y.where=y.where?`(${y.where}) AND (${D})`:
D));return y});return function(D){return A.apply(this,arguments)}}();Q.canResume=function(){return!aa.prototype.canResume.call(this)||m.isSome(this.timeExtent)&&this.timeExtent.isEmpty?!1:!0};q._createClass(Z,[{key:"availableFields",get:function(){const {layer:A,layer:{fieldsIndex:D},requiredFields:y}=this;return"outFields"in A&&A.outFields?C.fixFields(D,[...C.unpackFieldNames(D,A.outFields),...y]):C.fixFields(D,y)}},{key:"effect",get:function(){w.deprecatedProperty(H,"effect",{replacement:"featureEffect",
version:"4.22"});return this.featureEffect},set:function(A){w.deprecatedProperty(H,"effect",{replacement:"featureEffect",version:"4.22"});this.featureEffect=A}},{key:"featureEffect",get:function(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null},set:function(A){void 0===A?this._clearOverride("featureEffect"):this._override("featureEffect",A)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(A){H.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}},
{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return Z}(G);g.__decorate([t.property()],G.prototype,"_updatingRequiredFieldsPromise",void 0);g.__decorate([t.property({readOnly:!0})],G.prototype,"availableFields",null);g.__decorate([t.property()],G.prototype,"effect",null);g.__decorate([t.property({type:v})],G.prototype,"featureEffect",null);g.__decorate([t.property({type:B})],G.prototype,"filter",void 0);g.__decorate([t.property(d.combinedViewLayerTimeExtentProperty)],G.prototype,
"timeExtent",void 0);g.__decorate([t.property()],G.prototype,"layer",void 0);g.__decorate([t.property({type:Number})],G.prototype,"maximumNumberOfFeatures",null);g.__decorate([t.property({readOnly:!0,type:Boolean})],G.prototype,"maximumNumberOfFeaturesExceeded",null);g.__decorate([t.property({readOnly:!0})],G.prototype,"requiredFields",void 0);g.__decorate([t.property()],G.prototype,"suspended",void 0);g.__decorate([t.property()],G.prototype,"view",void 0);return G=g.__decorate([e.subclass("esri.views.layers.FeatureLayerView")],
G)};f.FeatureLayerView=l;f.default=l;Object.defineProperty(f,"__esModule",{value:!0})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(f,q,g,w){function u(){u=q._asyncToGenerator(function*(l,m=l.popupTemplate){if(!g.isSome(m))return[];const n=yield m.getRequiredFields(l.fieldsIndex);({lastEditInfoEnabled:m}=m);const {objectIdField:k,typeIdField:t,globalIdField:h,relationships:x}=
l;if(n.includes("*"))return["*"];m=m?yield w.getFeatureEditFields(l):[];const r=w.fixFields(l.fieldsIndex,[...n,...m]);t&&r.push(t);r&&k&&l.fieldsIndex.has(k)&&-1===r.indexOf(k)&&r.push(k);r&&h&&l.fieldsIndex.has(h)&&-1===r.indexOf(h)&&r.push(h);x&&x.forEach(e=>{({keyField:e}=e);r&&e&&l.fieldsIndex.has(e)&&-1===r.indexOf(e)&&r.push(e)});return r});return u.apply(this,arguments)}f.getFetchPopupTemplate=function(l,m){return l.popupTemplate?l.popupTemplate:g.isSome(m)&&m.defaultPopupTemplateEnabled&&
g.isSome(l.defaultPopupTemplate)?l.defaultPopupTemplate:null};f.getRequiredFields=function(l){return u.apply(this,arguments)};Object.defineProperty(f,"__esModule",{value:!0})})},"esri/views/layers/RefreshableLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(f,q,g,w,u,l,m,n,k,t,h){n=x=>{x=function(r){function e(){return r.apply(this,arguments)||this}q._inheritsLoose(e,r);e.prototype.initialize=function(){this.handles.add(l.on(this,"layer","refresh",d=>{this.doRefresh(d.dataChanged).catch(v=>{u.isAbortError(v)||w.getLogger(this.declaredClass).error(v)})}),"RefreshableLayerView")};return e}(x);g.__decorate([m.property()],x.prototype,"layer",void 0);return x=g.__decorate([h.subclass("esri.layers.mixins.RefreshableLayerView")],x)};f.RefreshableLayerView=
n;f.default=n;Object.defineProperty(f,"__esModule",{value:!0})})},"esri/views/support/drapedUtils":function(){define("exports ../../geometry ../../core/maybe ../../core/unitUtils ../../renderers/support/clickToleranceUtils ../../geometry/Extent".split(" "),function(f,q,g,w,u,l){function m(k,t,h,x=new l){let r;if("2d"===h.type)r=t*h.resolution;else if("3d"===h.type){var e=h.overlayPixelSizeInMapUnits(k),d=h.basemapSpatialReference;r=g.isSome(d)&&!d.equals(h.spatialReference)?w.getMetersPerUnitForSR(d)/
w.getMetersPerUnitForSR(h.spatialReference):t*e}t=k.x-r;e=k.y-r;d=k.x+r;k=k.y+r;({spatialReference:h}=h);x.xmin=Math.min(t,d);x.ymin=Math.min(e,k);x.xmax=Math.max(t,d);x.ymax=Math.max(e,k);x.spatialReference=h;return x}const n=new l;f.createQueryGeometry=m;f.intersectsDrapedGeometry=function(k,t,h){k=h.toMap(k);if(g.isNone(k))return!1;const x=u.calculateTolerance();return m(k,x,h,n).intersects(t)};Object.defineProperty(f,"__esModule",{value:!0})})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../AggregateGraphic ../../../geometry ../../../Graphic ../../../core/Collection ../../../core/Error ../../../core/has ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../layers/effects/FeatureEffectView ../../../layers/support/FeatureFilter ../../../renderers/support/clickToleranceUtils ../../../rest/support/FeatureSet ../../../rest/support/Query ../engine/webgl/definitions ./LayerView2D ./features/schemaUtils ./features/tileRenderers ./features/support/pixelBuffering ./support/clusterUtils ./support/FeatureCommandQueue ./support/FeatureLayerProxy ./support/util ../tiling/TileManager ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView ../../support/drapedUtils ../../webgl/capabilities ../../../geometry/Extent".split(" "),function(f,
q,g,w,u,l,m,n,k,t,h,x,r,e,d,v,B,C,F,M,K,J,H,G,aa,Z,Q,A,D,y,R,S,N,O,U,I,X,ca){function ma(ea){return ea&&"openPorts"in ea}const fa=t.getLogger("esri.views.2d.layers.FeatureLayerView2D");w=function(ea){function ia(){var a=ea.apply(this,arguments)||this;a._pipelineIsUpdating=!0;a._commandsQueue=new D({process:b=>{switch(b.type){case "processed-edit":return a._doEdit(b);case "refresh":return a._doRefresh(b.dataChanged);case "update":return a._doUpdate()}}});a._visibilityOverrides=new Set;a._highlightIds=
new Map;a._lastPixelBuffer=0;a._updateHighlight=x.debounce(f._asyncToGenerator(function*(){return a._proxy.setHighlight(Array.from(a._highlightIds.keys()))}));a._uploadsLocked=!1;a._needsClusterSizeUpdate=!1;a.featureEffectView=new C;a._lastDefinitionExpression=null;return a}f._inheritsLoose(ia,ea);var z=ia.prototype;z.destroy=function(){var a,b;h.andThen(this._updateClusterSizeTask,c=>c.remove());null==(a=this._proxy)?void 0:a.destroy();null==(b=this.tileRenderer)?void 0:b.destroy();this._commandsQueue.destroy()};
z.initialize=function(){this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()]));this.handles.add([this.on("valueRangesChanged",a=>{this._set("_aggregateValueRanges",a.valueRanges)}),r.react(()=>this.featureEffect,a=>{this.featureEffectView.featureEffect=a},{initial:!0,sync:!0})])};z._initProxy=function(){var a=f._asyncToGenerator(function*(){if("isTable"in this.layer&&this.layer.isTable)throw new m("featurelayerview:table-not-supported","table feature layer can't be displayed",
{layer:this.layer});this._proxy&&this._proxy.destroy();const b=this._createClientOptions();this._set("_proxy",new y({client:b}));return this._proxy.when()});return function(){return a.apply(this,arguments)}}();z._initServiceOptions=function(){var a=f._asyncToGenerator(function*(){this._set("_serviceOptions",yield this._createServiceOptions())});return function(){return a.apply(this,arguments)}}();z.fetchPopupFeatures=function(){var a=f._asyncToGenerator(function*(b,c){var p;if(h.isSome(c)&&0===c.clientGraphics.length)return[];
if("cluster"!==(null==(p=this.layer.featureReduction)?void 0:p.type)){p=M.calculateTolerance({renderer:"renderer"in this.layer&&this.layer.renderer,event:h.isSome(c)&&c.event});p=I.createQueryGeometry(b,p,this.view);({features:p}=yield this.queryVisibleFeatures(new J({geometry:p,outFields:["*"],returnGeometry:!0})));c=h.isSome(c)?c:{};const E=new Set(c.clientGraphics.map(L=>L.getObjectId()));for(const L of p)E.has(L.getObjectId())||c.clientGraphics.push(L)}return ea.prototype.fetchPopupFeatures.call(this,
b,c)});return function(b,c){return a.apply(this,arguments)}}();z.highlight=function(a){var b;let c;a instanceof u?c=[a.getObjectId()]:"number"===typeof a||"string"===typeof a?c=[a]:Array.isArray(a)&&0<a.length?c="number"===typeof a[0]||"string"===typeof a[0]?a:a.map(p=>null==p?void 0:p.getObjectId()):l.isCollection(a)&&0<a.length&&(c=a.map(p=>null==p?void 0:p.getObjectId()).toArray());c=null==(b=c)?void 0:b.filter(p=>null!=p);if(!c||!c.length)return{remove:()=>{}};this._addHighlight(c);return{remove:()=>
this._removeHighlight(c)}};z.hasHighlight=function(){return!!this._highlightIds.size};z.hitTest=function(){var a=f._asyncToGenerator(function*(b,c){if(!this.tileRenderer)return null;b=yield this.tileRenderer.hitTest(c);if(0===b.length)return null;const {features:p,aggregates:E}=yield this._proxy.getFeatures(b);return[...E.map(L=>this._createHittestResult(g.fromJSON(L))),...p.map(L=>this._createHittestResult(u.fromJSON(L)))]});return function(b,c){return a.apply(this,arguments)}}();z.queryAggregates=
function(){var a=f._asyncToGenerator(function*(){return(yield this._proxy.getAggregates()).map(b=>g.fromJSON(b))});return function(){return a.apply(this,arguments)}}();z.queryStatistics=function(){return this._proxy.queryStatistics()};z.querySummaryStatistics=function(){var a=f._asyncToGenerator(function*(b,c,p){c={...c,scale:this.view.scale};return this._proxy.querySummaryStatistics(this._cleanUpQuery(b),c,p)});return function(b,c,p){return a.apply(this,arguments)}}();z.queryUniqueValues=function(){var a=
f._asyncToGenerator(function*(b,c,p){c={...c,scale:this.view.scale};return this._proxy.queryUniqueValues(this._cleanUpQuery(b),c,p)});return function(b,c,p){return a.apply(this,arguments)}}();z.queryClassBreaks=function(){var a=f._asyncToGenerator(function*(b,c,p){c={...c,scale:this.view.scale};return this._proxy.queryClassBreaks(this._cleanUpQuery(b),c,p)});return function(b,c,p){return a.apply(this,arguments)}}();z.queryHistogram=function(){var a=f._asyncToGenerator(function*(b,c,p){c={...c,scale:this.view.scale};
return this._proxy.queryHistogram(this._cleanUpQuery(b),c,p)});return function(b,c,p){return a.apply(this,arguments)}}();z.queryFeatures=function(a,b){return this.queryFeaturesJSON(a,b).then(c=>{c=K.fromJSON(c);c.features.forEach(p=>this._setLayersForFeature(p));return c})};z.queryVisibleFeatures=function(a,b){return this._proxy.queryVisibleFeatures(this._cleanUpQuery(a),b).then(c=>{c=K.fromJSON(c);c.features.forEach(p=>this._setLayersForFeature(p));return c})};z.queryFeaturesJSON=function(a,b){return this._proxy.queryFeatures(this._cleanUpQuery(a),
b)};z.queryObjectIds=function(a,b){return this._proxy.queryObjectIds(this._cleanUpQuery(a),b)};z.queryFeatureCount=function(a,b){return this._proxy.queryFeatureCount(this._cleanUpQuery(a),b)};z.queryExtent=function(a,b){return this._proxy.queryExtent(this._cleanUpQuery(a),b).then(c=>({count:c.count,extent:ca.fromJSON(c.extent)}))};z.setVisibility=function(a,b){b?this._visibilityOverrides.delete(a):this._visibilityOverrides.add(a);this._update()};z.update=function(a){if(this._tileStrategy&&this.tileRenderer){var {hasMissingTiles:b,
added:c,removed:p}=this._tileStrategy.update(a);(c.length||p.length)&&this._proxy.updateTiles({added:c,removed:p});b&&this.requestUpdate();this.notifyChange("updating")}};z.attach=function(){this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`);this._tileStrategy=new S.TileManager({acquireTile:a=>this._acquireTile(a),releaseTile:a=>this._releaseTile(a),tileInfoView:this.view.featuresTilingScheme,buffer:0});this.handles.add(e.init(this,"renderingConfigHash",()=>this._update()),"attach");
"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",a=>this._edit(a)),"attach")};z.detach=function(){this.container.removeAllChildren();this.handles.remove("attach");this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null);this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null);this._tileRendererHash=null};z.moveStart=function(){this.requestUpdate()};z.viewChange=function(){this.requestUpdate()};z.moveEnd=function(){this.requestUpdate()};
z.isUpdating=function(){var a;const b="renderer"in this.layer&&null!=this.layer.renderer,c=this._commandsQueue.updating,p=null!=this._updatingRequiredFieldsPromise,E=!this._proxy||!this._proxy.isReady,L=this._pipelineIsUpdating,Y=null===this.tileRenderer||(null==(a=this.tileRenderer)?void 0:a.updating);a=b&&(c||p||E||L||Y);n("esri-2d-log-updating")&&console.log(`Updating FLV2D: ${a}\n  -> hasRenderer ${b}\n  -> hasPendingCommand ${c}\n  -> updatingRequiredFields ${p}\n  -> updatingProxy ${E}\n  -> updatingPipeline ${L}\n  -> updatingTileRenderer ${Y}\n`);
return a};z._createClientOptions=function(){return{setUpdating:a=>{this._set("_pipelineIsUpdating",a)},emitEvent:a=>{this.emit(a.name,a.event)}}};z._detectQueryMode=function(){var a=f._asyncToGenerator(function*(b){var c;const p="editingInfo"in this.layer&&(null==(c=this.layer.editingInfo)?void 0:c.lastEditDate);c=!!this.layer.refreshInterval;if("path"in b&&("feature"===this.layer.type||"subtype-group"===this.layer.type)&&"point"===this.layer.geometryType&&this.layer.capabilities.query.supportsPagination&&
!this.layer.capabilities.operations.supportsEditing&&(p||!c)&&n("featurelayer-snapshot-enabled"))try{const E=yield this.layer.queryFeatureCount(),L=n("featurelayer-snapshot-point-min-threshold");if(E<=L)return{mode:"snapshot",featureCount:E};const Y=n("featurelayer-snapshot-point-max-threshold"),V=n("featurelayer-snapshot-point-coverage"),da=this.view.extent,W=h.unwrap(this.layer.fullExtent),T=null==W?void 0:W.clone().intersection(da),P=h.isSome(T)?T.width*T.height:0,ba=(null==W?NaN:W.width)*(null==
W?NaN:W.height);b=0===ba?0:P/ba;if(E<=Y&&b>=V)return{mode:"snapshot",featureCount:E}}catch(E){fa.warn("mapview-feature-layer","Encountered an error when querying for featureCount",{error:E})}return{mode:"on-demand"}});return function(b){return a.apply(this,arguments)}}();z._createServiceOptions=function(){var a=f._asyncToGenerator(function*(){var b,c=this.layer;if("stream"===c.type)return null;const {capabilities:p,objectIdField:E}=c,L=c.fields.map(ha=>ha.toJSON()),Y=h.isSome(c.fullExtent)&&c.fullExtent.toJSON(),
V=R.toJSONGeometryType(c.geometryType),da=c.timeInfo&&c.timeInfo.toJSON()||null,W=c.spatialReference?c.spatialReference.toJSON():null,T="feature"===c.type?c.globalIdField:null;let P;"ogc-feature"===c.type?P=c.source.getFeatureDefinition():ma(c.source)?P=yield c.source.openPorts():c.parsedUrl&&(P=k.clone(c.parsedUrl),"dynamicDataSource"in c&&c.dynamicDataSource&&(P.query={layer:JSON.stringify({source:c.dynamicDataSource})}));c="datesInUnknownTimezone"in this.layer&&this.layer.datesInUnknownTimezone;
const ba=null!=(b="subtypeField"in this.layer&&this.layer.subtypeField)?b:null,{mode:ka,featureCount:la}=yield this._detectQueryMode(P);b=this.layer.objectIdField;if("feature"===this.layer.type&&h.isSome(this.layer.orderBy)&&this.layer.orderBy.length){const ha=!this.layer.orderBy[0].valueExpression&&this.layer.orderBy[0].field;ha&&(b=ha)}return{type:ka,timeReferenceUnknownClient:c,subtypeField:ba,featureCount:la,globalIdField:T,maxRecordCount:p.query.maxRecordCount,tileMaxRecordCount:p.query.tileMaxRecordCount,
capabilities:p,fields:L,fullExtent:Y,geometryType:V,objectIdField:E,source:P,timeInfo:da,spatialReference:W,orderByFields:b}});return function(){return a.apply(this,arguments)}}();z._createMemoryServiceOptions=function(){var a=f._asyncToGenerator(function*(b){b=yield b.openPorts();return{...this._createServiceOptions(),type:"memory",source:b}});return function(b){return a.apply(this,arguments)}}();z._cleanUpQuery=function(a){a=J.from(a)||this.createQuery();a.outSpatialReference||(a.outSpatialReference=
this.view.spatialReference);return a};z._update=function(){var a=f._asyncToGenerator(function*(){return this._commandsQueue.push({type:"update"})});return function(){return a.apply(this,arguments)}}();z._edit=function(){var a=f._asyncToGenerator(function*(b){if(this._validateEdit(b))return this._commandsQueue.push({type:"edit",edits:b})});return function(b){return a.apply(this,arguments)}}();z.doRefresh=function(){var a=f._asyncToGenerator(function*(b){return this._commandsQueue.push({type:"refresh",
dataChanged:b})});return function(b){return a.apply(this,arguments)}}();z._validateEdit=function(a){const b="globalIdField"in this.layer&&this.layer.globalIdField,c=a.deletedFeatures.some(E=>-1===E.objectId||!E.objectId),p=b&&this.availableFields.includes(b);return c&&!p?(fa.error(new m("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${b} to be included the layer's outFields for updates to be reflected on the map`)),null):a};z._doUpdate=function(){var a=f._asyncToGenerator(function*(){try{if(!this.destroyed&&
this._hasRequiredSupport(this.layer)&&this._tileStrategy){var {featureEffectView:b,filter:c}=this;yield this._updateRequiredFields();var {renderer:p}=this._getEffectiveRenderer();this._set("_effectiveRenderer",p);var E=this._createSchemaConfig(),L=R.toJSONGeometryType(this.layer.geometryType),Y=yield Q.computePxBuffer(p,L,this.view.resourceManager,this.layer.fields,this.layer.spatialReference,this.layer.featureReduction),V=this._createConfiguration(E,c,b.filter),da=this._lastDefinitionExpression!==
V.definitionExpression;this._lastDefinitionExpression=V.definitionExpression;this._lastPixelBuffer=0===Y?0:Math.max(Y,this._lastPixelBuffer);V.schema.source.pixelBuffer=this._lastPixelBuffer;var W=this._createTileRendererHash(p);"snapshot"===this._serviceOptions.type&&(V.schema.source.featureCount=this._serviceOptions.featureCount);if(W!==this._tileRendererHash){yield this._initTileRenderer(p);const T=this._serviceOptions;this.tileRenderer.onConfigUpdate(p);const P=this.layer;"stream"!==P.type&&ma(P.source)&&
(T.source=yield P.source.openPorts());"stream"===P.type&&(yield this._initServiceOptions());const ba={added:this._tileStrategy.tileKeys(),removed:[]};yield this._proxy.startup(this.view.featuresTilingScheme,V,T,ba);this.hasHighlight()&&(yield this._proxy.setHighlight(Array.from(this._highlightIds.keys())));yield this._onceTilesUpdated();this.tileRenderer.onConfigUpdate(p)}else{"snapshot"===this._serviceOptions.type&&da&&(V.schema.source.featureCount=yield this.layer.queryFeatureCount());const T=yield this._proxy.update(V);
(T.mesh||T.targets.aggregate)&&this._lockGPUUploads();try{yield this._proxy.applyUpdate(T)}catch(P){x.isAbortError(P)||fa.error(P)}(T.mesh||T.targets.aggregate)&&this._unlockGPUUploads();this.tileRenderer.onConfigUpdate(p);this._updateClusterSizeVariable();this._forceAttributeTextureUpload()}this._tileRendererHash=W;this.tileRenderer.invalidateLabels();this.requestUpdate()}}catch(T){}});return function(){return a.apply(this,arguments)}}();z._doEdit=function(){var a=f._asyncToGenerator(function*(b){try{yield this._proxy.onEdits(b)}catch(c){x.isAbortError(c)}});
return function(b){return a.apply(this,arguments)}}();z._doRefresh=function(){var a=f._asyncToGenerator(function*(b){this._lockGPUUploads();try{yield this._proxy.refresh(b)}catch(c){x.isAbortError(c)}this._unlockGPUUploads()});return function(b){return a.apply(this,arguments)}}();z._updateClusterSizeVariable=function(){this._needsClusterSizeUpdate&&(this.tileRenderer.onConfigUpdate(this._effectiveRenderer),this._needsClusterSizeUpdate=!1)};z._createUpdateClusterSizeTask=function(a,b){var c=this;return this.watch("_aggregateValueRanges",
function(){var p=f._asyncToGenerator(function*(E){c._updateClusterEffectiveRendererSizeVariable(a,b,E);c._needsClusterSizeUpdate=!0;c._uploadsLocked||c._updateClusterSizeVariable()});return function(E){return p.apply(this,arguments)}}())};z._updateClusterEffectiveRendererSizeVariable=function(){var a=f._asyncToGenerator(function*(b,c,p){if(b.dynamicClusterSize&&"visualVariables"in b&&b.visualVariables){var E=A.findSizeVV(b.visualVariables);h.isSome(E)&&"cluster_count"===E.field&&(E=b.visualVariables.indexOf(E),
b.visualVariables[E]=A.createClusterCountSizeVariable(c,p),b=b.clone(),b.dynamicClusterSize=!0,this._set("_effectiveRenderer",b))}});return function(b,c,p){return a.apply(this,arguments)}}();z._getEffectiveRenderer=function(){var a="renderer"in this.layer&&this.layer.renderer;const b=this.layer.featureReduction;h.isSome(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null);if(b&&"cluster"===b.type&&A.isClusterCompatibleRenderer(a)){const c=[];a=A.createClusterRenderer(c,
a,b,this._aggregateValueRanges);h.andThen(this._updateClusterSizeTask,p=>p.remove());this._updateClusterSizeTask=this._createUpdateClusterSizeTask(a,b);return{renderer:a,aggregateFields:c,featureReduction:b}}return{renderer:a,aggregateFields:[],featureReduction:null}};z._acquireTile=function(a){a=this.tileRenderer.acquireTile(a);a.once("attach",()=>{this.requestUpdate()});return a};z._releaseTile=function(a){this.tileRenderer.releaseTile(a)};z._initTileRenderer=function(){var a=f._asyncToGenerator(function*(b){const c=
yield Z.createOrReuseTileRenderer(b,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer.destroy(),this.tileRenderer=null);if(this.destroyed)return null;this._proxy.tileRenderer=c;this._set("tileRenderer",c);this.tileRenderer.install(this.container);this.tileRenderer.onConfigUpdate(b);this.requestUpdate();return this.tileRenderer});return function(b){return a.apply(this,
arguments)}}();z._createTileRendererHash=function(a){return`${"heatmap"===a.type?"heatmap":"symbol"}.${"dot-density"===a.type}`};z._injectOverrides=function(a){var b=h.isSome(a)?a.timeExtent:null;b=h.isSome(this.timeExtent)&&h.isSome(b)?this.timeExtent.intersection(b):this.timeExtent||b;var c=null;const p="floorInfo"in this.layer&&this.layer.floorInfo;p&&(c=h.isSome(a)&&a.where,c=this._addFloorFilterClause(c));if(!this._visibilityOverrides.size&&!b&&!p)return h.isSome(a)?a.toJSON():null;a=h.isSome(a)&&
a.clone()||new F;a.timeExtent=b;c&&(a.where=c);a=a.toJSON();a.hiddenIds=Array.from(this._visibilityOverrides);return a};z._addFloorFilterClause=function(a){var b=this.layer;a=a||"";if("floorInfo"in b&&b.floorInfo){var c,p=this.view.floors;if(!p||!p.length)return a;null!=(c=b.floorInfo.viewAllLevelIds)&&c.length&&(p=b.floorInfo.viewAllLevelIds);c=p.filter(E=>""!==E).map(E=>"'"+E+"'");c.push("''");b=b.floorInfo.floorField;p="("+b+" IN ({ids}) OR "+b+" IS NULL)";p=p.replace("{ids}",c.join(", "));h.isSome(a)&&
a.includes(b)&&(c=new RegExp("AND \\("+b+".*NULL\\)","g"),a=a.replace(c,""),c=new RegExp("\\("+b+".*NULL\\)","g"),a=a.replace(c,""),a=a.replace(/\s+/g," ").trim());a=""!==a?"("+a+") AND "+p:p}return""!==a?a:null};z._createConfiguration=function(a,b,c){const p="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,E="feature"===this.layer.type?this.layer.gdbVersion:void 0,L=Array(H.MAX_FILTERS);b=this._injectOverrides(b);L[0]=b;L[1]=h.isSome(c)?c.toJSON():
null;a=aa.createSchema(a);if(h.isNone(a))return null;c=X();return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:E,historicMoment:p,devicePixelRatio:window.devicePixelRatio||1,filters:L,schema:a,supportsTextureFloat:c.supportsTextureFloat,maxTextureSize:c.maxTextureSize}};z._hasRequiredSupport=function(a){var b;return"renderer"in a&&"dot-density"===(null==(b=a.renderer)?void 0:b.type)&&!X().supportsTextureFloat?(fa.error(new m("webgl-missing-extension",
"Missing WebGL extension OES_Texture_Float which is required for DotDensity")),!1):!0};z._onceTilesUpdated=function(){this.requestUpdate();return e.whenFalseOnce(this,"_pipelineIsUpdating",!1)};z._lockGPUUploads=function(){this.tileRenderer&&(this._uploadsLocked=!0,this.tileRenderer.lockGPUUploads())};z._unlockGPUUploads=function(){this.tileRenderer&&(this._uploadsLocked=!1,this.tileRenderer.unlockGPUUploads())};z._forceAttributeTextureUpload=function(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()};
z._createSchemaConfig=function(){return{renderer:"renderer"in this.layer&&this.layer.renderer,spatialReference:this.layer.spatialReference,timeExtent:this.layer.timeExtent,definitionExpression:this.layer.definitionExpression,featureReduction:this.layer.featureReduction,fields:this.layer.fields,geometryType:this.layer.geometryType,historicMoment:"feature"===this.layer.type?this.layer.historicMoment:null,labelsVisible:"labelsVisible"in this.layer&&this.layer.labelsVisible,labelingInfo:"labelingInfo"in
this.layer&&this.layer.labelingInfo,availableFields:this.availableFields,featureEffect:this.featureEffect,filter:this.filter,gdbVersion:"feature"===this.layer.type?this.layer.gdbVersion:null,pixelBuffer:0,orderBy:"orderBy"in this.layer&&this.layer.orderBy?this.layer.orderBy:null,customParameters:{..."customParameters"in this.layer?this.layer.customParameters:void 0,token:"apiKey"in this.layer?this.layer.apiKey:void 0}}};z._addHighlight=function(a){for(const b of a)this._highlightIds.has(b)?(a=this._highlightIds.get(b),
this._highlightIds.set(b,a+1)):this._highlightIds.set(b,1);this._updateHighlight().catch(b=>{x.isAbortError(b)||fa.error(b)})};z._removeHighlight=function(a){for(const b of a)this._highlightIds.has(b)&&(a=this._highlightIds.get(b)-1,0===a?this._highlightIds.delete(b):this._highlightIds.set(b,a));this._updateHighlight().catch(b=>{x.isAbortError(b)||fa.error(b)})};z._setLayersForFeature=function(a){const b=this.layer;a.layer=b;a.sourceLayer=b};z._createHittestResult=function(a){this._setLayersForFeature(a);
h.isSome(a.geometry)&&(a.geometry.spatialReference=this.view.spatialReference);return a};f._createClass(ia,[{key:"orderByFields",get:function(){return"stream"!==this._serviceOptions.type&&this._serviceOptions.orderByFields}},{key:"labelsVisible",get:function(){const a="subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer];return!this.suspended&&a.some(b=>b.labelingInfo&&b.labelsVisible)}},{key:"queryMode",get:function(){return this._serviceOptions.type}},{key:"renderingConfigHash",
get:function(){if(!this.layer)return null;const a=this.availableFields;var b=this.layer;const c=this.view.floors,{definitionExpression:p}=b,E="subtype-group"!==this.layer.type&&this.layer.labelsVisible&&this.layer.labelingInfo,L="renderer"in b&&b.renderer,Y="feature"===b.type?b.gdbVersion:void 0,V="feature"===b.type&&b.historicMoment?b.historicMoment.getTime():void 0,{timeExtent:da}=this,W="customParameters"in b?JSON.stringify(b.customParameters):void 0,T="apiKey"in b?b.apiKey:void 0,P="stream"===
b.type?`${JSON.stringify(b.geometryDefinition)}${b.definitionExpression}`:null,ba=JSON.stringify(this.clips);b=b.featureReduction&&b.featureReduction.toJSON();const ka="orderBy"in this.layer&&JSON.stringify(this.layer.orderBy),la="sublayers"in this.layer&&this.layer.sublayers.items.reduce((ha,ja)=>ha+`${ja.visible?1:0}.${JSON.stringify(ja.renderer)}.${ja.labelsVisible}\n.${JSON.stringify(ja.labelingInfo)}`,"");return JSON.stringify({orderBy:ka,sublayerHash:la,filterHash:h.isSome(this.filter)&&this.filter.toJSON(),
effectHash:h.isSome(this.featureEffect)&&this.featureEffect.toJSON(),streamFilter:P,gdbVersion:Y,definitionExpression:p,historicMoment:V,availableFields:a,renderer:L,labelingInfo:E,timeExtent:da,floors:c,clipsHash:ba,featureReduction:b,customParameters:W,apiKey:T})}},{key:"hasFilter",get:function(){const a=!!("floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length);return!!this.filter||a||!!this._visibilityOverrides.size||!!this.timeExtent}}]);return ia}(N.FeatureLayerView(U.RefreshableLayerView(G.LayerView2DMixin(O))));
q.__decorate([d.property()],w.prototype,"_serviceOptions",void 0);q.__decorate([d.property()],w.prototype,"_proxy",void 0);q.__decorate([d.property()],w.prototype,"_pipelineIsUpdating",void 0);q.__decorate([d.property()],w.prototype,"_effectiveRenderer",void 0);q.__decorate([d.property()],w.prototype,"_aggregateValueRanges",void 0);q.__decorate([d.property()],w.prototype,"_commandsQueue",void 0);q.__decorate([d.property()],w.prototype,"featureEffectView",void 0);q.__decorate([d.property()],w.prototype,
"labelsVisible",null);q.__decorate([d.property({readOnly:!0})],w.prototype,"queryMode",null);q.__decorate([d.property()],w.prototype,"renderingConfigHash",null);q.__decorate([d.property()],w.prototype,"tileRenderer",void 0);q.__decorate([d.property()],w.prototype,"updating",void 0);return w=q.__decorate([B.subclass("esri.views.2d.layers.FeatureLayerView2D")],w)});