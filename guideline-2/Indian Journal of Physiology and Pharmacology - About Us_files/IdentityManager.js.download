// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
require({cache:{"esri/identity/IdentityManagerBase":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../config ../kernel ../request ../core/Error ../core/Evented ../core/events ../core/lang ../core/object ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./IdentityForm ./IdentityModal ./OAuthCredential ./OAuthInfo ./ServerInfo".split(" "),function(x,u,p,
n,r,I,B,V,J,W,G,A,y,Q,X,Y,L,Z,ka,ia,aa){const R={},la=S=>{const T=(new y.Url(S.owningSystemUrl)).host;S=(new y.Url(S.server)).host;const q=/.+\.arcgis\.com$/i;return q.test(T)&&q.test(S)},ca=(S,T)=>!!(la(S)&&T&&T.some(q=>q.test(S.server)));let da=null,ea=null;try{da=window.localStorage,ea=window.sessionStorage}catch{}X=function(S){function T(){var a=S.call(this)||this;a._portalConfig=globalThis.esriGeowConfig;a.serverInfos=[];a.oAuthInfos=[];a.credentials=[];a._soReqs=[];a._xoReqs=[];a._portals=[];
a.defaultOAuthInfo=null;a.defaultTokenValidity=60;a.dialog=null;a.formConstructor=L;a.tokenValidity=null;a.normalizeWebTierAuth=!1;a._appOrigin="null"!==window.origin?window.origin:window.location.origin;a._appUrlObj=y.urlToObject(window.location.href);a._busy=null;a._rejectOnPersistedPageShow=!1;a._oAuthHash=null;a._gwTokenUrl="/sharing/rest/generateToken";a._agsRest="/rest/services";a._agsPortal=/\/sharing(\/|$)/i;a._agsAdmin=/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i;a._adminSvcs=/\/rest\/admin\/services(\/|$)/i;
a._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,
customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}];a._legacyFed=[];a._regexSDirUrl=/http.+\/rest\/services\/?/gi;a._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|MapServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer)).*/gi;
a._gwUser=/http.+\/users\/([^\/]+)\/?.*/i;a._gwItem=/http.+\/items\/([^\/]+)\/?.*/i;a._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i;a._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i;a._createDefaultOAuthInfo=!0;a._hasTestedIfAppIsOnPortal=!1;a._getOAuthHash();window.addEventListener("pageshow",c=>{a._pageShowHandler(c)});return a}u._inheritsLoose(T,S);var q=T.prototype;q.registerServers=function(a){const c=this.serverInfos;c?(a=a.filter(d=>!this.findServerInfo(d.server)),this.serverInfos=c.concat(a)):
this.serverInfos=a;a.forEach(d=>{d.owningSystemUrl&&this._portals.push(d.owningSystemUrl);d.hasPortal&&this._portals.push(d.server)})};q.registerOAuthInfos=function(a){const c=this.oAuthInfos;if(c){for(const d of a){const e=this.findOAuthInfo(d.portalUrl);e&&c.splice(c.indexOf(e),1)}this.oAuthInfos=c.concat(a)}else this.oAuthInfos=a};q.registerToken=function(a){a={...a};const c=this._sanitizeUrl(a.server),d=this._isServerRsrc(c);let e=this.findServerInfo(c),b=!0,g;e||(e=new aa,e.server=this._getServerInstanceRoot(c),
d?e.hasServer=!0:(e.tokenServiceUrl=this._getTokenSvcUrl(c),e.hasPortal=!0),this.registerServers([e]));(g=this._findCredential(c))?(delete a.server,Object.assign(g,a),b=!1):(g=new x.Credential({userId:a.userId,server:e.server,token:a.token,expires:a.expires,ssl:a.ssl,scope:d?"server":"portal"}),g.resources=[c],this.credentials.push(g));g.emitTokenChange(!1);b||g.refreshServerTokens()};q.toJSON=function(){return W.fixJson({serverInfos:this.serverInfos.map(a=>a.toJSON()),oAuthInfos:this.oAuthInfos.map(a=>
a.toJSON()),credentials:this.credentials.map(a=>a.toJSON())})};q.initialize=function(a){if(a){"string"===typeof a&&(a=JSON.parse(a));var c=a.serverInfos,d=a.oAuthInfos;a=a.credentials;if(c){const e=[];c.forEach(b=>{b.server&&b.tokenServiceUrl&&e.push(b.declaredClass?b:new aa(b))});e.length&&this.registerServers(e)}if(d){const e=[];d.forEach(b=>{b.appId&&e.push(b.declaredClass?b:new ia(b))});e.length&&this.registerOAuthInfos(e)}a&&a.forEach(e=>{e.server&&e.token&&e.expires&&e.expires>Date.now()&&(e=
e.declaredClass?e:new x.Credential(e),e.emitTokenChange(),this.credentials.push(e))})}};q.findServerInfo=function(a){let c;a=this._sanitizeUrl(a);for(const d of this.serverInfos)if(this._hasSameServerInstance(d.server,a)){c=d;break}return c};q.findOAuthInfo=function(a){let c;a=this._sanitizeUrl(a);for(const d of this.oAuthInfos)if(this._hasSameServerInstance(d.portalUrl,a)){c=d;break}return c};q.findCredential=function(a,c){let d;a=this._sanitizeUrl(a);const e=this._isServerRsrc(a)?"server":"portal";
if(c)for(const b of this.credentials){if(this._hasSameServerInstance(b.server,a)&&c===b.userId&&b.scope===e){d=b;break}}else for(const b of this.credentials)if(this._hasSameServerInstance(b.server,a)&&-1!==this._getIdenticalSvcIdx(a,b)&&b.scope===e){d=b;break}return d};q.getCredential=function(a,c){let d=!0;if(c){var e=!!c.token;var b=c.error;d=!1!==c.prompt}c={...c};a=this._sanitizeUrl(a);const g=new AbortController,h=A.createResolver();if(c.signal)A.onAbort(c.signal,()=>{g.abort()});A.onAbort(g,
()=>{h.reject(new B("identity-manager:user-aborted","ABORTED"))});if(A.isAborted(g))return h.promise;c.signal=g.signal;const k=this._isAdminResource(a);if((e=e?this.findCredential(a):null)&&b&&b.details&&498===b.details.httpStatus)e.destroy();else if(e)return a=new B("identity-manager:not-authorized","You are currently signed in as: '"+e.userId+"'. You do not have access to this resource: "+a,{error:b}),h.reject(a),h.promise;if(b=this._findCredential(a,c))return h.resolve(b),h.promise;let f=this.findServerInfo(a);
if(f)!f.hasServer&&this._isServerRsrc(a)&&(f._restInfoPms=this._getTokenSvcUrl(a),f.hasServer=!0);else{b=this._getTokenSvcUrl(a);if(!b)return a=new B("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),h.reject(a),h.promise;f=new aa;f.server=this._getServerInstanceRoot(a);"string"===typeof b?(f.tokenServiceUrl=b,f.hasPortal=!0):(f._restInfoPms=b,f.hasServer=!0);this.registerServers([f])}f.hasPortal&&void 0===f._selfReq&&(d||y.hasSameOrigin(f.tokenServiceUrl,
this._appOrigin)||this._gwDomains.some(l=>l.tokenServiceUrl===f.tokenServiceUrl))&&(f._selfReq={owningTenant:c&&c.owningTenant,selfDfd:this._getPortalSelf(f.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),a)});return this._enqueue(a,f,c,h,k)};q.getResourceName=function(a){return this._isRESTService(a)?a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(a)&&a.replace(this._gwUser,"$1")||this._gwItem.test(a)&&a.replace(this._gwItem,"$1")||
this._gwGroup.test(a)&&a.replace(this._gwGroup,"$1")||""};q.generateToken=function(a,c,d){const e=this._rePortalTokenSvc.test(a.tokenServiceUrl),b=new y.Url(this._appOrigin);var g=a.shortLivedTokenValidity;let h,k,f,l,v,t,C;c&&(C=this.tokenValidity||g||this.defaultTokenValidity,C>g&&0<g&&(C=g));d&&(h=d.isAdmin,k=d.serverUrl,f=d.token,v=d.signal,t=d.ssl,a.customParameters=d.customParameters);h?g=a.adminTokenServiceUrl:(g=a.tokenServiceUrl,l=new y.Url(g.toLowerCase()),a.webTierAuth&&null!=d&&d.serverUrl&&
!t&&"http"===b.scheme&&(y.hasSameOrigin(b.uri,g,!0)||"https"===l.scheme&&b.host===l.host&&"7080"===b.port&&"7443"===l.port)&&(g=g.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));d={query:{request:"getToken",username:null==c?void 0:c.username,password:null==c?void 0:c.password,serverUrl:k,token:f,expiration:C,referer:h||e?this._appOrigin:null,client:h?"referer":null,f:"json",...a.customParameters},method:"post",authMode:"anonymous",useProxy:this._useProxy(a,d),signal:v,...null==d?void 0:d.ioArgs};
e||(d.withCredentials=!1);return I(g,d).then(E=>{E=E.data;if(!E||!E.token)return new B("identity-manager:authentication-failed","Unable to generate token");const w=a.server;R[w]||(R[w]={});c&&(R[w][c.username]=c.password);E.validity=C;return E})};q.isBusy=function(){return!!this._busy};q.checkSignInStatus=function(a){return this.checkAppAccess(a,"").then(c=>c.credential)};q.checkAppAccess=function(a,c,d){let e=!1;return this.getCredential(a,{prompt:!1}).then(b=>{let g;const h={f:"json"};if("portal"===
b.scope)if(c&&(this._doPortalSignIn(a)||d&&d.force))g=b.server+"/sharing/rest/oauth2/validateAppAccess",h.client_id=c;else if(b.token)g=b.server+"/sharing/rest";else return{credential:b};else if(b.token)g=b.server+"/rest/services";else return{credential:b};b.token&&(h.token=b.token);return I(g,{query:h,authMode:"anonymous"}).then(k=>{if(!1===k.data.valid)throw new B("identity-manager:not-authorized",`You are currently signed in as: '${b.userId}'.`,k.data);e=!!k.data.viewOnlyUserTypeApp;return{credential:b}}).catch(k=>
{if("identity-manager:not-authorized"===k.name)throw k;k=k.details&&k.details.httpStatus;if(498===k)throw b.destroy(),new B("identity-manager:not-authenticated","User is not signed in.");if(400===k)throw new B("identity-manager:invalid-request");return{credential:b}})}).then(b=>({credential:b.credential,viewOnly:e}))};q.setOAuthResponseHash=function(a){var c;const d=this._oAuthDfd;this._oAuthDfd=null;if(d&&a)if(clearInterval(this._oAuthIntervalId),null==(c=this._oAuthOnHashHandle)?void 0:c.remove(),
"#"===a.charAt(0)&&(a=a.substring(1)),a=y.queryToObject(a),a.error)c="access_denied"===a.error,a=new B(c?"identity-manager:user-aborted":"identity-manager:authentication-failed",c?"ABORTED":"OAuth: "+a.error+" - "+a.error_description),d.reject(a);else{c=d.oinfo_;const e=c._oAuthCred,b=new x.Credential({userId:a.username,server:d.sinfo_.server,token:a.access_token,expires:Date.now()+1E3*Number(a.expires_in),ssl:"true"===a.ssl,_oAuthCred:e});c.userId=b.userId;e.storage=a.persist?da:ea;e.token=b.token;
e.expires=b.expires;e.userId=b.userId;e.ssl=b.ssl;e.save();d.resolve(b)}};q.setOAuthRedirectionHandler=function(a){this._oAuthRedirectFunc=a};q.setProtocolErrorHandler=function(a){this._protocolFunc=a};q.signIn=function(a,c,d={}){const e=A.createResolver(),b=()=>{var v,t,C,E,w;null==(v=k)?void 0:v.remove();null==(t=f)?void 0:t.remove();null==(C=l)?void 0:C.remove();null==(E=h)?void 0:E.destroy();null==(w=this.dialog)?void 0:w.destroy();this.dialog=h=k=f=l=null},g=()=>{b();this._oAuthDfd=null;e.reject(new B("identity-manager:user-aborted",
"ABORTED"))};if(d.signal)A.onAbort(d.signal,()=>{g()});let h=new this.formConstructor;h.resource=this.getResourceName(a);h.server=c.server;this.dialog=new Z;this.dialog.content=h;this.dialog.open=!0;this.emit("dialog-create");let k=h.on("cancel",g),f=this.dialog.watch("open",g),l=h.on("submit",v=>{this.generateToken(c,v,{isAdmin:d.isAdmin,signal:d.signal}).then(t=>{b();t=new x.Credential({userId:v.username,server:c.server,token:t.token,expires:null!=t.expires?Number(t.expires):null,ssl:!!t.ssl,isAdmin:d.isAdmin,
validity:t.validity});e.resolve(t)}).catch(t=>{h.error=t;h.signingIn=!1})});return e.promise};q.oAuthSignIn=function(a,c,d,e){const b=this._oAuthDfd=A.createResolver();if(null!=e&&e.signal)A.onAbort(e.signal,()=>{const t=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;t&&!t.closed?t.close():this.dialog&&h()});b.resUrl_=a;b.sinfo_=c;b.oinfo_=d;e=!e||!1!==e.oAuthPopupConfirmation;if(!d.popup||!e)return this._doOAuthSignIn(a,c,d),b.promise;const g=new this.formConstructor;g.oAuthPrompt=!0;g.server=c.server;
this.dialog=new Z;this.dialog.content=g;this.dialog.open=!0;this.emit("dialog-create");const h=()=>{v();this._oAuthDfd=null;b.reject(new B("identity-manager:user-aborted","ABORTED"))},k=g.on("cancel",h),f=this.dialog.watch("open",h),l=g.on("submit",()=>{v();this._doOAuthSignIn(a,c,d)}),v=()=>{k.remove();f.remove();l.remove();g.destroy();this.dialog.destroy();this.dialog=null};return b.promise};q.destroyCredentials=function(){this.credentials&&this.credentials.slice().forEach(a=>{a.destroy()});this.emit("credentials-destroy")};
q.enablePostMessageAuth=function(a="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove();this._postMessageAuthHandle=J.on(window,"message",c=>{var d;if((c.origin===this._appOrigin||c.origin.endsWith(".arcgis.com"))&&"arcgis:auth:requestCredential"===(null==(d=c.data)?void 0:d.type)){const e=c.source;this.getCredential(a).then(b=>{e.postMessage({type:"arcgis:auth:credential",credential:{expires:b.expires,server:b.server,ssl:b.ssl,token:b.token,userId:b.userId}},
c.origin)}).catch(b=>{e.postMessage({type:"arcgis:auth:error",error:{name:b.name,message:b.message}},c.origin)})}})};q.disablePostMessageAuth=function(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)};q._getOAuthHash=function(){var a=window.location.hash;if(a){"#"===a.charAt(0)&&(a=a.substring(1));a=y.queryToObject(a);let c=!1;if(a.access_token&&a.expires_in&&a.state&&a.hasOwnProperty("username"))try{a.state=JSON.parse(a.state),"object"===typeof a.state&&
a.state.portalUrl&&(this._oAuthHash=a,c=!0)}catch{}else a.error&&a.error_description&&(console.log("IdentityManager OAuth Error: ",a.error," - ",a.error_description),"access_denied"===a.error&&(c=!0));c&&(window.location.hash="object"===typeof a.state&&a.state.hash||"")}};q._pageShowHandler=function(a){a.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow&&(a=new B("identity-manager:user-aborted","ABORTED"),this._errbackFunc(a))};q._findCredential=function(a,c){let d=-1,e,b,g;const h=c&&c.token;
c=c&&c.resource;const k=this._isServerRsrc(a)?"server":"portal",f=this.credentials.filter(l=>this._hasSameServerInstance(l.server,a)&&l.scope===k);a=c||a;if(f.length)if(1===f.length)if(c=f[0],b=(e=(g=this.findServerInfo(c.server))&&g.owningSystemUrl)&&this.findCredential(e,c.userId),d=this._getIdenticalSvcIdx(a,c),h)-1!==d&&(c.resources.splice(d,1),this._removeResource(a,b));else return-1===d&&c.resources.push(a),this._addResource(a,b),c;else{let l,v;f.some(t=>{v=this._getIdenticalSvcIdx(a,t);return-1!==
v?(l=t,b=(e=(g=this.findServerInfo(l.server))&&g.owningSystemUrl)&&this.findCredential(e,l.userId),d=v,!0):!1});if(h)l&&(l.resources.splice(d,1),this._removeResource(a,b));else if(l)return this._addResource(a,b),l}};q._findOAuthInfo=function(a){let c=this.findOAuthInfo(a);if(!c)for(const d of this.oAuthInfos)if(this._isIdProvider(d.portalUrl,a)){c=d;break}return c};q._addResource=function(a,c){c&&-1===this._getIdenticalSvcIdx(a,c)&&c.resources.push(a)};q._removeResource=function(a,c){let d=-1;c&&
(d=this._getIdenticalSvcIdx(a,c),-1<d&&c.resources.splice(d,1))};q._useProxy=function(a,c){return c&&c.isAdmin&&!y.hasSameOrigin(a.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(a.tokenServiceUrl)&&"10.1"===String(a.currentVersion)&&!y.hasSameOrigin(a.tokenServiceUrl,this._appOrigin)};q._getOrigin=function(a){a=new y.Url(a);return a.scheme+"://"+a.host+(null!=a.port?":"+a.port:"")};q._getServerInstanceRoot=function(a){const c=a.toLowerCase();let d=c.indexOf(this._agsRest);-1===d&&this._isAdminResource(a)&&
(d=this._agsAdmin.test(a)?a.replace(this._agsAdmin,"$1").length:a.search(this._adminSvcs));-1===d&&(d=c.indexOf("/sharing"));-1===d&&"/"===c.substr(-1)&&(d=c.length-1);return-1<d?a.substring(0,d):a};q._hasSameServerInstance=function(a,c){"/"===a.substr(-1)&&(a=a.slice(0,-1));a=a.toLowerCase();c=this._getServerInstanceRoot(c).toLowerCase();a=this._normalizeAGOLorgDomain(a);c=this._normalizeAGOLorgDomain(c);a=a.substr(a.indexOf(":"));c=c.substr(c.indexOf(":"));return a===c};q._normalizeAGOLorgDomain=
function(a){const c=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,d=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,e=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;c.test(a)?a=a.replace(c,"https://www.arcgis.com"):d.test(a)?a=a.replace(d,"https://devext.arcgis.com"):e.test(a)&&(a=a.replace(e,"https://qaext.arcgis.com"));return a};q._sanitizeUrl=function(a){const c=(n.request.proxyUrl||"").toLowerCase(),d=c?a.toLowerCase().indexOf(c+"?"):-1;-1!==d&&(a=a.substring(d+c.length+
1));a=y.normalize(a);return y.urlToObject(a).path};q._isRESTService=function(a){return-1<a.indexOf(this._agsRest)};q._isAdminResource=function(a){return this._agsAdmin.test(a)||this._adminSvcs.test(a)};q._isServerRsrc=function(a){return this._isRESTService(a)||this._isAdminResource(a)};q._isIdenticalService=function(a,c){if(this._isRESTService(a)&&this._isRESTService(c)){a=this._getSuffix(a).toLowerCase();c=this._getSuffix(c).toLowerCase();var d=a===c;d||(d=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi,
d=a.replace(d,"$1")===c.replace(d,"$1"))}else this._isAdminResource(a)&&this._isAdminResource(c)?d=!0:this._isServerRsrc(a)||this._isServerRsrc(c)||!this._isPortalDomain(a)||(d=!0);return d};q._isPortalDomain=function(a){const c=new y.Url(a.toLowerCase());a=this._portalConfig;let d=this._gwDomains.some(e=>e.regex.test(c.uri));!d&&a&&(d=this._hasSameServerInstance(this._getServerInstanceRoot(a.restBaseUrl),c.uri));d||n.portalUrl&&(d=y.hasSameOrigin(c,n.portalUrl,!0));d||(d=this._portals.some(e=>this._hasSameServerInstance(e,
c.uri)));return d=d||this._agsPortal.test(c.path)};q._isIdProvider=function(a,c){let d=-1,e=-1;this._gwDomains.forEach((g,h)=>{-1===d&&g.regex.test(a)&&(d=h);-1===e&&g.regex.test(c)&&(e=h)});let b=!1;if(-1<d&&-1<e)if(0===d||4===d){if(0===e||4===e)b=!0}else if(1===d){if(1===e||2===e)b=!0}else 2===d?2===e&&(b=!0):3===d&&3===e&&(b=!0);if(!b){const g=this.findServerInfo(c),h=g&&g.owningSystemUrl;h&&la(g)&&this._isPortalDomain(h)&&this._isIdProvider(a,h)&&(b=!0)}return b};q._getIdenticalSvcIdx=function(a,
c){let d=-1;for(let e=0;e<c.resources.length;e++)if(this._isIdenticalService(a,c.resources[e])){d=e;break}return d};q._getSuffix=function(a){return a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")};q._getTokenSvcUrl=function(a){if(this._isRESTService(a)||this._isAdminResource(a)){var c=this._getServerInstanceRoot(a);var d=c+"/admin/generateToken";a=c+"/rest/info";c=I(a,{query:{f:"json"}}).then(e=>e.data);return{adminUrl:d,promise:c}}if(this._isPortalDomain(a)){let e="";this._gwDomains.some(b=>
{b.regex.test(a)&&(e=b.tokenServiceUrl);return!!e});e||this._portals.some(b=>{this._hasSameServerInstance(b,a)&&(e=b+this._gwTokenUrl);return!!e});e||(d=a.toLowerCase().indexOf("/sharing"),-1!==d&&(e=a.substring(0,d)+this._gwTokenUrl));e||(e=this._getOrigin(a)+this._gwTokenUrl);e&&(d=(new y.Url(a)).port,/^http:\/\//i.test(a)&&"7080"===d&&(e=e.replace(/:7080/i,":7443")),e=e.replace(/http:/i,"https:"));return e}if(-1!==a.toLowerCase().indexOf("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"};
q._exchangeToken=function(a,c,d){return I(`${a}/sharing/rest/oauth2/exchangeToken`,{authMode:"anonymous",method:"post",query:{f:"json",client_id:c,token:d}}).then(e=>e.data.token)};q._getPlatformSelf=function(a,c){a=a.replace(/^http:/i,"https:");return I(`${a}/sharing/rest/oauth2/platformSelf`,{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":c,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json"},withCredentials:!0}).then(d=>d.data)};q._getPortalSelf=
function(a,c){let d;this._gwDomains.some(e=>{e.regex.test(a)&&(d=e.customBaseUrl);return!!d});if(d)return Promise.resolve({allSSL:!0,currentVersion:"4.4",customBaseUrl:d,portalMode:"multitenant",supportsOAuth:!0});this._appOrigin.startsWith("https:")?a=a.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(c)&&(a=a.replace(/^https:/i,"http:").replace(/:7443/i,":7080"));return I(a,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then(e=>e.data)};q._doPortalSignIn=function(a){const c=
this._portalConfig,d=window.location.href,e=this.findServerInfo(a);return(c||this._isPortalDomain(d))&&(e?e.hasPortal||e.owningSystemUrl&&this._isPortalDomain(e.owningSystemUrl):this._isPortalDomain(a))&&(this._isIdProvider(d,a)||c&&(this._hasSameServerInstance(this._getServerInstanceRoot(c.restBaseUrl),a)||this._isIdProvider(c.restBaseUrl,a))||y.hasSameOrigin(d,a,!0))?!0:!1};q._checkProtocol=function(a,c,d,e){let b=!0;e=e?c.adminTokenServiceUrl:c.tokenServiceUrl;e.trim().toLowerCase().startsWith("https:")&&
!this._appOrigin.startsWith("https:")&&y.getProxyRule(e)&&(b=this._protocolFunc?!!this._protocolFunc({resourceUrl:a,serverInfo:c}):!1,b||(a=new B("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection."),d(a)));return b};q._enqueue=function(a,c,d,e,b,g){e||(e=A.createResolver());e.resUrl_=a;e.sinfo_=c;e.options_=d;e.admin_=b;e.refresh_=g;this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(a),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&
this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(e)):this._xoReqs.push(e):this._doSignIn(e);return e.promise};q._doSignIn=function(a){this._busy=a;this._rejectOnPersistedPageShow=!1;const c=f=>{var l=a.options_&&a.options_.resource;const v=a.resUrl_,t=a.refresh_;let C=!1;-1===this.credentials.indexOf(f)&&(t&&-1!==this.credentials.indexOf(t)?(t.userId=f.userId,t.token=f.token,t.expires=f.expires,t.validity=f.validity,t.ssl=f.ssl,t.creationTime=f.creationTime,C=!0,f=t):this.credentials.push(f));f.resources||
(f.resources=[]);f.resources.push(l||v);f.scope=this._isServerRsrc(v)?"server":"portal";f.emitTokenChange();l=this._soReqs;const E={};this._soReqs=[];l.forEach(w=>{if(!this._isIdenticalService(v,w.resUrl_)){const F=this._getSuffix(w.resUrl_);E[F]||(E[F]=!0,f.resources.push(w.resUrl_))}});a.resolve(f);l.forEach(w=>{this._hasSameServerInstance(this._getServerInstanceRoot(v),w.resUrl_)?w.resolve(f):this._soReqs.push(w)});this._busy=a.resUrl_=a.sinfo_=a.refresh_=null;C||this.emit("credential-create",
{credential:f});this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},d=f=>{a.reject(f);this._busy=a.resUrl_=a.sinfo_=a.refresh_=null;this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},e=(f,l,v,t)=>{var C,E;const w=a.sinfo_,F=!a.options_||!1!==a.options_.prompt,M=w.hasPortal&&this._findOAuthInfo(a.resUrl_);let K,ba;if(f)c(new x.Credential({userId:f,server:w.server,token:v||
null,expires:null!=t?Number(t):null,ssl:!!l}));else if(window!==window.parent&&null!=(C=this._appUrlObj.query)&&C["arcgis-auth-origin"]&&null!=(E=this._appUrlObj.query)&&E["arcgis-auth-portal"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),a.resUrl_)){var fa;window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);const D=J.on(window,"message",N=>{N.source===window.parent&&N.data&&("arcgis:auth:credential"===
N.data.type?(D.remove(),N.data.credential.expires<Date.now()?d(new B("identity-manager:credential-request-failed","Parent application's token has expired.")):c(new x.Credential(N.data.credential))):"arcgis:auth:error"===N.data.type&&(D.remove(),"tokenExpiredError"===N.data.error.name?d(new B("identity-manager:credential-request-failed","Parent application's token has expired.")):d(B.fromJSON(N.data.error))))});A.onAbort(null==(fa=a.options_)?void 0:fa.signal,()=>{D.remove()})}else if(M){let D=M._oAuthCred;
D||(f=new ka(M,da),l=new ka(M,ea),f.isValid()&&l.isValid()?f.expires>l.expires?(D=f,l.destroy()):(D=l,f.destroy()):D=f.isValid()?f:l,M._oAuthCred=D);if(D.isValid())K=new x.Credential({userId:D.userId,server:w.server,token:D.token,expires:D.expires,ssl:D.ssl,_oAuthCred:D}),M.appId!==D.appId&&this._doPortalSignIn(a.resUrl_)?a._pendingDfd=this._exchangeToken(K.server,M.appId,K.token).then(N=>{K.token=N;D.token=N;D.save();c(K)}).catch(()=>{c(K)}):c(K);else if(this._oAuthHash&&this._hasSameServerInstance(M.portalUrl,
this._oAuthHash.state.portalUrl))f=this._oAuthHash,K=new x.Credential({userId:f.username,server:w.server,token:f.access_token,expires:Date.now()+1E3*Number(f.expires_in),ssl:"true"===f.ssl,oAuthState:f.state,_oAuthCred:D}),M.userId=K.userId,D.storage=f.persist?da:ea,D.token=K.token,D.expires=K.expires,D.userId=K.userId,D.ssl=K.ssl,D.save(),this._oAuthHash=null,c(K);else{const N=()=>{F?a._pendingDfd=this.oAuthSignIn(a.resUrl_,w,M,a.options_).then(c,d):(ba=new B("identity-manager:not-authenticated",
"User is not signed in."),d(ba))};this._doPortalSignIn(a.resUrl_)?a._pendingDfd=this._getPlatformSelf(w.server,M.appId).then(({portalUrl:ja,token:na,username:oa})=>{!ja||y.hasSameOrigin(ja,this._appOrigin,!0)?(K=new x.Credential({server:w.server,userId:oa,token:na}),c(K)):N()}).catch(N):N()}}else F?this._checkProtocol(a.resUrl_,w,d,a.admin_)&&(f=a.options_,a.admin_&&(f=f||{},f.isAdmin=!0),a._pendingDfd=this.signIn(a.resUrl_,w,f).then(c,d)):(ba=new B("identity-manager:not-authenticated","User is not signed in."),
d(ba))},b=()=>{const f=a.sinfo_;var l=f.owningSystemUrl;const v=a.options_;let t,C,E,w;v&&(t=v.token,C=v.error,E=v.prompt);w=this._findCredential(l,{token:t,resource:a.resUrl_});if(!w)for(const F of this.credentials)if(this._isIdProvider(l,F.server)){w=F;break}w?(l=this.findCredential(a.resUrl_,w.userId))?c(l):ca(f,this._legacyFed)?(l=w.toJSON(),l.server=f.server,l.resources=null,c(new x.Credential(l))):(a._pendingDfd=this.generateToken(this.findServerInfo(w.server),null,{serverUrl:a.resUrl_,token:w.token,
signal:a.options_.signal,ssl:w.ssl})).then(F=>{c(new x.Credential({userId:w.userId,server:f.server,token:F.token,expires:null!=F.expires?Number(F.expires):null,ssl:!!F.ssl,isAdmin:a.admin_,validity:F.validity}))},d):(this._busy=null,t&&(a.options_.token=null),(a._pendingDfd=this.getCredential(l.replace(/\/?$/,"/sharing"),{resource:a.resUrl_,owningTenant:f.owningTenant,signal:a.options_.signal,token:t,error:C,prompt:E})).then(()=>{this._enqueue(a.resUrl_,a.sinfo_,a.options_,a,a.admin_)},F=>{a.resUrl_=
a.sinfo_=a.refresh_=null;a.reject(F)}))};this._errbackFunc=d;const g=a.sinfo_.owningSystemUrl,h=this._isServerRsrc(a.resUrl_),k=a.sinfo_._restInfoPms;k?k.promise.then(f=>{const l=a.sinfo_;l._restInfoPms&&(l.adminTokenServiceUrl=l._restInfoPms.adminUrl,l._restInfoPms=null,l.tokenServiceUrl=G.getDeepValue("authInfo.tokenServicesUrl",f)||G.getDeepValue("authInfo.tokenServiceUrl",f)||G.getDeepValue("tokenServiceUrl",f),l.shortLivedTokenValidity=G.getDeepValue("authInfo.shortLivedTokenValidity",f),l.currentVersion=
f.currentVersion,l.owningTenant=f.owningTenant,(f=l.owningSystemUrl=f.owningSystemUrl)&&this._portals.push(f));h&&l.owningSystemUrl?b():e()},()=>{a.sinfo_._restInfoPms=null;const f=new B("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");d(f)}):h&&g?b():a.sinfo_._selfReq?a.sinfo_._selfReq.selfDfd.then(f=>{const l={};let v,t,C,E;f&&(v=f.user&&f.user.username,l.username=v,l.allSSL=f.allSSL,t=f.supportsOAuth,C=f.currentVersion,"multitenant"===
f.portalMode&&(E=f.customBaseUrl));a.sinfo_.webTierAuth=!!v;return v&&this.normalizeWebTierAuth?this.generateToken(a.sinfo_,null,{ssl:l.allSSL}).catch(()=>null).then(w=>{l.portalToken=w&&w.token;l.tokenExpiration=w&&w.expires;return l}):!v&&t&&4.4<=parseFloat(C)&&!this._findOAuthInfo(a.resUrl_)?this._generateOAuthInfo({portalUrl:a.sinfo_.server,customBaseUrl:E,owningTenant:a.sinfo_._selfReq.owningTenant}).catch(()=>null).then(()=>l):l}).catch(()=>null).then(f=>{a.sinfo_._selfReq=null;f?e(f.username,
f.allSSL,f.portalToken,f.tokenExpiration):e()}):e()};q._generateOAuthInfo=function(a){let c,d=a.portalUrl;const e=a.customBaseUrl,b=a.owningTenant;if(a=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal){c=window.location.href;let g=c.indexOf("?");-1<g&&(c=c.slice(0,g));g=c.search(/\/(apps|home)\//);c=-1<g?c.slice(0,g):null}a&&c?(this._hasTestedIfAppIsOnPortal=!0,a=I(c+"/sharing/rest",{query:{f:"json"}}).then(()=>{this.defaultOAuthInfo=new ia({appId:"arcgisonline",
popupCallbackUrl:c+"/home/oauth-callback.html"})})):a=Promise.resolve();return a.then(()=>{if(this.defaultOAuthInfo)return d=d.replace(/^http:/i,"https:"),I(d+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:b,client_id:this.defaultOAuthInfo.appId,redirect_uri:y.makeAbsolute(this.defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(g=>{if(g.data.valid){const h=this.defaultOAuthInfo.clone();h.portalUrl=g.data.urlKey&&e?"https://"+g.data.urlKey.toLowerCase()+"."+e:d;h.popup=window!==window.top||
!(y.hasSameOrigin(d,this._appOrigin)||this._gwDomains.some(k=>k.regex.test(d)&&k.regex.test(this._appOrigin)));this.oAuthInfos.push(h)}})})};q._doOAuthSignIn=function(a,c,d){var e={portalUrl:d.portalUrl};!d.popup&&d.preserveUrlHash&&window.location.hash&&(e.hash=window.location.hash);e={client_id:d.appId,response_type:"token",state:JSON.stringify(e),expiration:d.expiration,locale:d.locale,redirect_uri:d.popup?y.makeAbsolute(d.popupCallbackUrl):window.location.href.replace(/#.*$/,"")};d.forceLogin&&
(e.force_login=!0);d.forceUserId&&d.userId&&(e.prepopulatedusername=d.userId);!d.popup&&this._doPortalSignIn(a)&&(e.redirectToUserOrgUrl=!0);const b=d.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",g=b+"?"+y.objectToQuery(e);if(d.popup){const h=window.open(g,"esriJSAPIOAuth",d.popupWindowFeatures);h?(h.focus(),this._oAuthDfd.oAuthWin_=h,this._oAuthIntervalId=setInterval(()=>{if(h.closed){clearInterval(this._oAuthIntervalId);this._oAuthOnHashHandle.remove();const k=this._oAuthDfd;
if(k){const f=new B("identity-manager:user-aborted","ABORTED");k.reject(f)}}},500),this._oAuthOnHashHandle=J.on(window,"arcgis:auth:hash",k=>{this.setOAuthResponseHash(k.detail)})):(a=new B("identity-manager:popup-blocked","ABORTED"),this._oAuthDfd.reject(a))}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:e,authorizeUrl:b,resourceUrl:a,serverInfo:c,oAuthInfo:d}):window.location.href=g};return T}(V);X.prototype.declaredClass="esri.identity.IdentityManagerBase";
x.Credential=function(S){function T(a){var c=S.call(this,a)||this;c._oAuthCred=null;c.tokenRefreshBuffer=2;a&&a._oAuthCred&&(c._oAuthCred=a._oAuthCred);return c}u._inheritsLoose(T,S);var q=T.prototype;q.initialize=function(){this.resources=this.resources||[];null==this.creationTime&&(this.creationTime=Date.now())};q.refreshToken=function(){const a=r.id.findServerInfo(this.server),c=a&&a.owningSystemUrl,d=!!c&&"server"===this.scope,e=d&&ca(a,r.id._legacyFed);var b=a.webTierAuth;const g=b&&r.id.normalizeWebTierAuth;
var h=R[this.server];h=h&&h[this.userId];let k=this.resources&&this.resources[0],f=d&&r.id.findServerInfo(c),l={username:this.userId,password:h},v;if(!b||g)if(d&&!f&&r.id.serverInfos.some(t=>{r.id._isIdProvider(c,t.server)&&(f=t);return!!f}),b=f&&r.id.findCredential(f.server,this.userId),!d||b)if(e)b.refreshToken();else{if(d)v={serverUrl:k,token:b&&b.token,ssl:b&&b.ssl};else if(g)l=null,v={ssl:this.ssl};else if(h)this.isAdmin&&(v={isAdmin:!0});else{let t;k&&(k=r.id._sanitizeUrl(k),this._enqueued=
1,t=r.id._enqueue(k,a,null,null,this.isAdmin,this),t.then(()=>{this._enqueued=0;this.refreshServerTokens()}).catch(()=>{this._enqueued=0}));return t}return r.id.generateToken(d?f:a,d?null:l,v).then(t=>{this.token=t.token;this.expires=null!=t.expires?Number(t.expires):null;this.creationTime=Date.now();this.validity=t.validity;this.emitTokenChange();this.refreshServerTokens()}).catch(()=>{})}};q.refreshServerTokens=function(){"portal"===this.scope&&r.id.credentials.forEach(a=>{const c=r.id.findServerInfo(a.server),
d=c&&c.owningSystemUrl;a!==this&&a.userId===this.userId&&d&&"server"===a.scope&&(r.id._hasSameServerInstance(this.server,d)||r.id._isIdProvider(d,this.server))&&(ca(c,r.id._legacyFed)?(a.token=this.token,a.expires=this.expires,a.creationTime=this.creationTime,a.validity=this.validity,a.emitTokenChange()):a.refreshToken())})};q.emitTokenChange=function(a){clearTimeout(this._refreshTimer);var c=this.server&&r.id.findServerInfo(this.server);const d=(c=c&&c.owningSystemUrl)&&r.id.findServerInfo(c);!1===
a||c&&"portal"!==this.scope&&(!d||!d.webTierAuth||r.id.normalizeWebTierAuth)||null==this.expires&&null==this.validity||this._startRefreshTimer();this.emit("token-change")};q.destroy=function(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null;this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const a=r.id.credentials.indexOf(this);-1<a&&r.id.credentials.splice(a,1);this.emitTokenChange();this.emit("destroy")};q.toJSON=function(){const a=
W.fixJson({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),c=this.resources;c&&0<c.length&&(a.resources=c.slice());return a};q._startRefreshTimer=function(){clearTimeout(this._refreshTimer);const a=6E4*this.tokenRefreshBuffer,c=2**31-1;let d=(this.validity?this.creationTime+6E4*this.validity:this.expires)-Date.now();0>d?d=0:d>c&&(d=c);this._refreshTimer=setTimeout(this.refreshToken.bind(this),
d>a?d-a:d)};return T}(V.EventedAccessor);p.__decorate([Q.property()],x.Credential.prototype,"creationTime",void 0);p.__decorate([Q.property()],x.Credential.prototype,"expires",void 0);p.__decorate([Q.property()],x.Credential.prototype,"isAdmin",void 0);p.__decorate([Q.property()],x.Credential.prototype,"oAuthState",void 0);p.__decorate([Q.property()],x.Credential.prototype,"resources",void 0);p.__decorate([Q.property()],x.Credential.prototype,"scope",void 0);p.__decorate([Q.property()],x.Credential.prototype,
"server",void 0);p.__decorate([Q.property()],x.Credential.prototype,"ssl",void 0);p.__decorate([Q.property()],x.Credential.prototype,"token",void 0);p.__decorate([Q.property()],x.Credential.prototype,"tokenRefreshBuffer",void 0);p.__decorate([Q.property()],x.Credential.prototype,"userId",void 0);p.__decorate([Q.property()],x.Credential.prototype,"validity",void 0);x.Credential=p.__decorate([Y.subclass("esri.identity.Credential")],x.Credential);x.IdentityManagerBase=X;Object.defineProperty(x,"__esModule",
{value:!0})})},"esri/identity/IdentityForm":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../intl/substitute ../widgets/Widget ../widgets/support/widgetUtils ../widgets/support/decorators/messageBundle ../core/Logger ../widgets/support/jsxFactory".split(" "),function(x,u,p,n,r,I,B,V,J,W,G,A,y){n=function(Q){function X(L,
Z){L=Q.call(this,L,Z)||this;L._usernameInputNode=null;L._passwordInputNode=null;L.messages=null;L.signingIn=!1;L.server=null;L.resource=null;L.error=null;L.oAuthPrompt=!1;return L}x._inheritsLoose(X,Q);var Y=X.prototype;Y.render=function(){const {error:L,server:Z,resource:ka,signingIn:ia,oAuthPrompt:aa,messages:R}=this,la=y.tsx("div",{class:"esri-identity-form__group"},V.substitute(aa?R.oAuthInfo:R.info,{server:/\.arcgis\.com/i.test(Z)?"ArcGIS Online":Z,resource:`(${ka||R.lblItem})`})),ca=aa?null:
y.tsx("div",{class:"esri-identity-form__group",key:"username"},y.tsx("label",{class:"esri-identity-form__label"},R.lblUser,y.tsx("input",{value:"",required:!0,autocomplete:"off",spellcheck:!1,type:"text",bind:this,afterCreate:W.storeNode,"data-node-ref":"_usernameInputNode",class:"esri-input"}))),da=aa?null:y.tsx("div",{class:"esri-identity-form__group",key:"password"},y.tsx("label",{class:"esri-identity-form__label"},R.lblPwd,y.tsx("input",{value:"",required:!0,type:"password",bind:this,afterCreate:W.storeNode,
"data-node-ref":"_passwordInputNode",class:"esri-input"}))),ea=y.tsx("div",{class:this.classes("esri-identity-form__group","esri-identity-form__footer")},y.tsx("input",{type:"submit",disabled:!!ia,value:ia?R.lblSigning:R.lblOk,class:"esri-button"}),y.tsx("input",{type:"button",value:R.lblCancel,bind:this,onclick:this._cancel,class:this.classes("esri-button","esri-button--secondary")})),S=L?y.tsx("div",null,L.details&&L.details.httpStatus?R.invalidUser:R.noAuthService):null;return y.tsx("form",{class:"esri-identity-form",
bind:this,onsubmit:this._submit},la,S,ca,da,ea)};Y._cancel=function(){this._set("signingIn",!1);this._usernameInputNode&&(this._usernameInputNode.value="");this._passwordInputNode&&(this._passwordInputNode.value="");this.emit("cancel")};Y._submit=function(L){L.preventDefault();this._set("signingIn",!0);this.emit("submit",this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&this._passwordInputNode.value})};return X}(J);u.__decorate([p.property(),
G.messageBundle("esri/identity/t9n/identity")],n.prototype,"messages",void 0);u.__decorate([p.property()],n.prototype,"signingIn",void 0);u.__decorate([p.property()],n.prototype,"server",void 0);u.__decorate([p.property()],n.prototype,"resource",void 0);u.__decorate([p.property()],n.prototype,"error",void 0);u.__decorate([p.property()],n.prototype,"oAuthPrompt",void 0);return n=u.__decorate([B.subclass("esri.identity.IdentityForm")],n)})},"esri/identity/IdentityModal":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/handleUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../widgets/Widget ../widgets/support/widget ../widgets/support/decorators/messageBundle ../widgets/support/jsxFactory".split(" "),
function(x,u,p,n,r,I,B,V,J,W,G,A){function y(b,g){var h=Object.keys(b);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(b);g&&(k=k.filter(function(f){return Object.getOwnPropertyDescriptor(b,f).enumerable}));h.push.apply(h,k)}return h}function Q(b){for(var g=1;g<arguments.length;g++){var h=null!=arguments[g]?arguments[g]:{};g%2?y(Object(h),!0).forEach(function(k){var f=h[k];k in b?Object.defineProperty(b,k,{value:f,enumerable:!0,configurable:!0,writable:!0}):b[k]=f}):Object.getOwnPropertyDescriptors?
Object.defineProperties(b,Object.getOwnPropertyDescriptors(h)):y(Object(h)).forEach(function(k){Object.defineProperty(b,k,Object.getOwnPropertyDescriptor(h,k))})}return b}r='input select textarea a[href] button [tabindex] audio[controls] video[controls] [contenteditable]:not([contenteditable\x3d"false"]) details\x3esummary:first-of-type details'.split(" ");var X=r.join(","),Y="undefined"===typeof Element?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,
L=function(b,g,h){var k=Array.prototype.slice.apply(b.querySelectorAll(X));g&&Y.call(b,X)&&k.unshift(b);return k=k.filter(h)},Z=function(b){var g=parseInt(b.getAttribute("tabindex"),10);return isNaN(g)?"true"===b.contentEditable||("AUDIO"===b.nodeName||"VIDEO"===b.nodeName||"DETAILS"===b.nodeName)&&null===b.getAttribute("tabindex")?0:b.tabIndex:g},ka=function(b,g){return b.tabIndex===g.tabIndex?b.documentOrder-g.documentOrder:b.tabIndex-g.tabIndex},ia=function(b){return"DETAILS"===b.tagName&&Array.prototype.slice.apply(b.children).some(function(g){return"SUMMARY"===
g.tagName})},aa=function(b,g){for(var h=0;h<b.length;h++)if(b[h].checked&&b[h].form===g)return b[h]},R=function(b){if(!b.name)return!0;var g=b.form||b.ownerDocument,h=function(f){return g.querySelectorAll('input[type\x3d"radio"][name\x3d"'+f+'"]')};if("undefined"!==typeof window&&"undefined"!==typeof window.CSS&&"function"===typeof window.CSS.escape)var k=h(window.CSS.escape(b.name));else try{k=h(b.name)}catch(f){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",
f.message),!1}h=aa(k,b.form);return!h||h===b},la=function(b,g){if("hidden"===getComputedStyle(b).visibility)return!0;var h=Y.call(b,"details\x3esummary:first-of-type")?b.parentElement:b;if(Y.call(h,"details:not([open]) *"))return!0;if(!g||"full"===g)for(;b;){if("none"===getComputedStyle(b).display)return!0;b=b.parentElement}else if("non-zero-area"===g)return b=b.getBoundingClientRect(),g=b.height,0===b.width&&0===g;return!1},ca=function(b,g){var h;(h=g.disabled)||(h="INPUT"===g.tagName&&"hidden"===
g.type);if(!(b=h||la(g,b.displayCheck)||ia(g)))a:{if("INPUT"===g.tagName||"SELECT"===g.tagName||"TEXTAREA"===g.tagName||"BUTTON"===g.tagName)for(b=g.parentElement;b;){if("FIELDSET"===b.tagName&&b.disabled){for(h=0;h<b.children.length;h++){var k=b.children.item(h);if("LEGEND"===k.tagName){if(k.contains(g)){b=!1;break a}break}}b=!0;break a}b=b.parentElement}b=!1}return b?!1:!0},da=function(b,g){(b=!ca(b,g))||(b="INPUT"===g.tagName&&"radio"===g.type&&!R(g));return b||0>Z(g)?!1:!0},ea=function(b,g){g=
g||{};var h=[],k=[];L(b,g.includeContainer,da.bind(null,g)).forEach(function(f,l){var v=Z(f);0===v?h.push(f):k.push({documentOrder:l,tabIndex:v,node:f})});return k.sort(ka).map(function(f){return f.node}).concat(h)},S=r.concat("iframe").join(","),T=function(b,g){g=g||{};if(!b)throw Error("No node provided");return!1===Y.call(b,S)?!1:ca(g,b)},q=function(){var b=[];return{activateTrap:function(g){if(0<b.length){var h=b[b.length-1];h!==g&&h.pause()}h=b.indexOf(g);-1!==h&&b.splice(h,1);b.push(g)},deactivateTrap:function(g){g=
b.indexOf(g);-1!==g&&b.splice(g,1);0<b.length&&b[b.length-1].unpause()}}}(),a=function(b,g){var h=-1;b.every(function(k,f){return g(k)?(h=f,!1):!0});return h},c=function(b){for(var g=arguments.length,h=Array(1<g?g-1:0),k=1;k<g;k++)h[k-1]=arguments[k];return"function"===typeof b?b.apply(void 0,h):b},d=function(b){return b.target.shadowRoot&&"function"===typeof b.composedPath?b.composedPath()[0]:b.target},e=function(b,g){var h=(null===g||void 0===g?void 0:g.document)||document,k=Q({returnFocusOnDeactivate:!0,
escapeDeactivates:!0,delayInitialFocus:!0},g),f=[],l=[],v=null,t=null,C=!1,E=!1,w=void 0,F=function(H,m,z){return H&&void 0!==H[m]?H[m]:k[z||m]},M=function(H){return!(!H||!f.some(function(m){return m.contains(H)}))},K=function(H){var m=k[H];if("function"===typeof m){for(var z=arguments.length,O=Array(1<z?z-1:0),P=1;P<z;P++)O[P-1]=arguments[P];m=m.apply(void 0,O)}if(!m){if(void 0===m||!1===m)return m;throw Error("`".concat(H,"` was specified but was not a node, or did not return a node"));}z=m;if("string"===
typeof m&&(z=h.querySelector(m),!z))throw Error("`".concat(H,"` as selector refers to no known node"));return z},ba=function(){var H=K("initialFocus");if(!1===H)return!1;void 0===H&&(H=M(h.activeElement)?h.activeElement:(H=l[0])&&H.firstTabbableNode||K("fallbackFocus"));if(!H)throw Error("Your focus-trap needs to have at least one focusable element");return H},fa=function(){l=f.map(function(H){var m=ea(H);if(0<m.length)return{container:H,firstTabbableNode:m[0],lastTabbableNode:m[m.length-1]}}).filter(function(H){return!!H});
if(0>=l.length&&!K("fallbackFocus"))throw Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");},D=function z(m){!1!==m&&m!==h.activeElement&&(m&&m.focus?(m.focus({preventScroll:!!k.preventScroll}),t=m,m.tagName&&"input"===m.tagName.toLowerCase()&&"function"===typeof m.select&&m.select()):z(ba()))},N=function(m){var z=K("setReturnFocus",m);return z?z:!1===z?!1:m},ja=function(m){var z=d(m);M(z)||(c(k.clickOutsideDeactivates,m)?ha.deactivate({returnFocus:k.returnFocusOnDeactivate&&
!T(z)}):c(k.allowOutsideClick,m)||m.preventDefault())},na=function(m){var z=d(m),O=M(z);O||z instanceof Document?O&&(t=z):(m.stopImmediatePropagation(),D(t||ba()))},oa=function(m){var z=d(m);fa();var O=null;if(0<l.length){var P=a(l,function(ma){return ma.container.contains(z)});if(0>P)O=m.shiftKey?l[l.length-1].lastTabbableNode:l[0].firstTabbableNode;else if(m.shiftKey){var U=a(l,function(ma){return z===ma.firstTabbableNode});0>U&&l[P].container===z&&(U=P);0<=U&&(O=l[0===U?l.length-1:U-1].lastTabbableNode)}else U=
a(l,function(ma){return z===ma.lastTabbableNode}),0>U&&l[P].container===z&&(U=P),0<=U&&(O=l[U===l.length-1?0:U+1].firstTabbableNode)}else O=K("fallbackFocus");O&&(m.preventDefault(),D(O))},pa=function(m){"Escape"!==m.key&&"Esc"!==m.key&&27!==m.keyCode||!1===c(k.escapeDeactivates,m)?"Tab"!==m.key&&9!==m.keyCode||oa(m):(m.preventDefault(),ha.deactivate())},qa=function(m){if(!c(k.clickOutsideDeactivates,m)){var z=d(m);M(z)||c(k.allowOutsideClick,m)||(m.preventDefault(),m.stopImmediatePropagation())}},
ra=function(){if(C)return q.activateTrap(ha),w=k.delayInitialFocus?setTimeout(function(){D(ba())},0):D(ba()),h.addEventListener("focusin",na,!0),h.addEventListener("mousedown",ja,{capture:!0,passive:!1}),h.addEventListener("touchstart",ja,{capture:!0,passive:!1}),h.addEventListener("click",qa,{capture:!0,passive:!1}),h.addEventListener("keydown",pa,{capture:!0,passive:!1}),ha},sa=function(){if(C)return h.removeEventListener("focusin",na,!0),h.removeEventListener("mousedown",ja,!0),h.removeEventListener("touchstart",
ja,!0),h.removeEventListener("click",qa,!0),h.removeEventListener("keydown",pa,!0),ha};var ha={activate:function(m){if(C)return this;var z=F(m,"onActivate"),O=F(m,"onPostActivate"),P=F(m,"checkCanFocusTrap");P||fa();C=!0;E=!1;v=h.activeElement;z&&z();m=function(){P&&fa();ra();O&&O()};if(P)return P(f.concat()).then(m,m),this;m();return this},deactivate:function(m){if(!C)return this;clearTimeout(w);w=void 0;sa();E=C=!1;q.deactivateTrap(ha);var z=F(m,"onDeactivate"),O=F(m,"onPostDeactivate"),P=F(m,"checkCanReturnFocus");
z&&z();var U=F(m,"returnFocus","returnFocusOnDeactivate");m=function(){setTimeout(function(){U&&D(N(v));O&&O()},0)};if(U&&P)return P(N(v)).then(m,m),this;m();return this},pause:function(){if(E||!C)return this;E=!0;sa();return this},unpause:function(){if(!E||!C)return this;E=!1;fa();ra();return this},updateContainerElements:function(m){f=[].concat(m).filter(Boolean).map(function(z){return"string"===typeof z?h.querySelector(z):z});C&&fa();return this}};ha.updateContainerElements(b);return ha};J=function(b){function g(k,
f){var l=b.call(this,k,f)||this;l.container=document.createElement("div");l.content=null;l.open=!1;l._close=()=>{l.open=!1};document.body.appendChild(l.container);l.own(l.watch("open",()=>l._toggleFocusTrap()));return l}x._inheritsLoose(g,b);var h=g.prototype;h.destroy=function(){this._destroyFocusTrap()};h.render=function(){var k=this.id;const {open:f,content:l,title:v,messages:t}=this;var C=f&&!!l;const E={["esri-identity-modal--open"]:C,["esri-identity-modal--closed"]:!C},w=A.tsx("button",{class:"esri-identity-modal__close-button",
"aria-label":t.close,title:t.close,bind:this,onclick:this._close},A.tsx("span",{"aria-hidden":"true",class:"esri-icon-close"})),F=`${k}_title`;k=`${k}_content`;const M=v?A.tsx("h1",{id:F,class:"esri-identity-modal__title"},v):null;C=C?A.tsx("div",{bind:this,class:"esri-identity-modal__dialog",role:"dialog","aria-labelledby":F,"aria-describedby":k,afterCreate:this._createFocusTrap},w,M,this._renderContent(k)):null;return A.tsx("div",{tabIndex:-1,class:this.classes("esri-identity-modal",E)},C)};h._destroyFocusTrap=
function(){var k;null==(k=this._focusTrap)?void 0:k.deactivate({onDeactivate:null});this._focusTrap=null};h._toggleFocusTrap=function(){const {_focusTrap:k,open:f}=this;k&&(f?k.activate():k.deactivate())};h._createFocusTrap=function(k){this._destroyFocusTrap();const f=requestAnimationFrame(()=>{this._focusTrap=e(k,{initialFocus:"input",onDeactivate:this._close});this._toggleFocusTrap()});this.own(p.makeHandle(()=>cancelAnimationFrame(f)))};h._renderContent=function(k){const f=this.content;return"string"===
typeof f?A.tsx("div",{class:"esri-identity-modal__content",id:k,innerHTML:f}):W.isWidget(f)?A.tsx("div",{class:"esri-identity-modal__content",id:k},f.render()):f instanceof HTMLElement?A.tsx("div",{class:"esri-identity-modal__content",id:k,bind:f,afterCreate:this._attachToNode}):null};h._attachToNode=function(k){k.appendChild(this)};return g}(J);u.__decorate([n.property({readOnly:!0})],J.prototype,"container",void 0);u.__decorate([n.property()],J.prototype,"content",void 0);u.__decorate([n.property()],
J.prototype,"open",void 0);u.__decorate([n.property(),G.messageBundle("esri/t9n/common")],J.prototype,"messages",void 0);u.__decorate([n.property({aliasOf:"messages.auth.signIn"})],J.prototype,"title",void 0);return J=u.__decorate([V.subclass("esri.identity.IdentityModal")],J)})},"esri/identity/OAuthCredential":function(){define(function(){let x=function(){function u(n,r){this.userId=this.token=this.ssl=this.expires=this.appId=this.storage=this.oAuthInfo=null;this.oAuthInfo=n;this.storage=r;this._init()}
var p=u.prototype;p.isValid=function(){let n=!1;if(this.oAuthInfo&&this.token&&this.userId){const r=Date.now();this.expires>r&&(this.expires-r)/1E3>60*this.oAuthInfo.minTimeUntilExpiration&&(n=!0)}return n};p.save=function(){if(this.storage){var n=this._load(),r=this.oAuthInfo;if(r&&r.authNamespace&&r.portalUrl){let I=n[r.authNamespace];I||(I=n[r.authNamespace]={});I[r.portalUrl]={appId:this.appId=r.appId,expires:this.expires,ssl:this.ssl,token:this.token,userId:this.userId};try{this.storage.setItem("esriJSAPIOAuth",
JSON.stringify(n))}catch(B){console.log(B)}}}};p.destroy=function(){const n=this._load(),r=this.oAuthInfo;if(r&&r.appId&&r.portalUrl&&this.token&&this.expires>Date.now()){var I=r.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken";const B=new FormData;B.append("f","json");B.append("auth_token",this.token);B.append("client_id",r.appId);B.append("token_type_hint","access_token");if("function"===typeof navigator.sendBeacon)navigator.sendBeacon(I,B);else{const V=new XMLHttpRequest;
V.open("POST",I);V.send(B)}}if(r&&r.authNamespace&&r.portalUrl&&this.storage&&(I=n[r.authNamespace])){delete I[r.portalUrl];try{this.storage.setItem("esriJSAPIOAuth",JSON.stringify(n))}catch(B){console.log(B)}}r&&(this.oAuthInfo=r._oAuthCred=null)};p._init=function(){var n=this._load();const r=this.oAuthInfo;r&&r.authNamespace&&r.portalUrl&&(n=n[r.authNamespace])&&(n=n[r.portalUrl])&&(this.appId=n.appId,this.expires=n.expires,this.ssl=n.ssl,this.token=n.token,this.userId=n.userId)};p._load=function(){let n=
{};if(this.storage){const r=this.storage.getItem("esriJSAPIOAuth");if(r)try{n=JSON.parse(r)}catch(I){console.log(I)}}return n};return u}();x.prototype.declaredClass="esri.identity.OAuthCredential";return x})},"esri/identity/OAuthInfo":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass".split(" "),function(x,
u,p,n,r,I,B,V){var J;p=J=function(W){function G(A){A=W.call(this,A)||this;A._oAuthCred=null;A.appId=null;A.authNamespace="/";A.expiration=20160;A.forceLogin=!1;A.forceUserId=!1;A.locale=null;A.minTimeUntilExpiration=30;A.popup=!1;A.popupCallbackUrl="oauth-callback.html";A.popupWindowFeatures="height\x3d490,width\x3d800,resizable,scrollbars,status";A.portalUrl="https://www.arcgis.com";A.preserveUrlHash=!1;A.userId=null;return A}x._inheritsLoose(G,W);G.prototype.clone=function(){return J.fromJSON(this.toJSON())};
return G}(p.JSONSupport);u.__decorate([n.property({json:{write:!0}})],p.prototype,"appId",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,"authNamespace",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,"expiration",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,"forceLogin",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,"forceUserId",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,"locale",void 0);u.__decorate([n.property({json:{write:!0}})],
p.prototype,"minTimeUntilExpiration",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,"popup",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,"popupCallbackUrl",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,"popupWindowFeatures",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,"portalUrl",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,"preserveUrlHash",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,
"userId",void 0);return p=J=u.__decorate([V.subclass("esri.identity.OAuthInfo")],p)})},"esri/identity/ServerInfo":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass".split(" "),function(x,u,p,n,r,I,B,V){p=function(J){function W(G){G=J.call(this,G)||this;G.adminTokenServiceUrl=null;G.currentVersion=null;
G.hasPortal=null;G.hasServer=null;G.owningSystemUrl=null;G.owningTenant=null;G.server=null;G.shortLivedTokenValidity=null;G.tokenServiceUrl=null;G.webTierAuth=null;return G}x._inheritsLoose(W,J);return W}(p.JSONSupport);u.__decorate([n.property({json:{write:!0}})],p.prototype,"adminTokenServiceUrl",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,"currentVersion",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,"hasPortal",void 0);u.__decorate([n.property({json:{write:!0}})],
p.prototype,"hasServer",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,"owningSystemUrl",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,"owningTenant",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,"server",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,"shortLivedTokenValidity",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,"tokenServiceUrl",void 0);u.__decorate([n.property({json:{write:!0}})],p.prototype,"webTierAuth",
void 0);return p=u.__decorate([V.subclass("esri.identity.ServerInfo")],p)})},"*noref":1}});define(["../chunks/_rollupPluginBabelHelpers","../kernel","./IdentityManagerBase"],function(x,u,p){p=function(n){function r(){return n.apply(this,arguments)||this}x._inheritsLoose(r,n);return r}(p.IdentityManagerBase);p.prototype.declaredClass="esri.identity.IdentityManager";p=new p;u.setId(p);return p});